# ğŸ§§ Base çº¢åŒ… dApp å®Œæ•´å¼€å‘æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [æŠ€æœ¯æ ˆè¯¦è§£](#æŠ€æœ¯æ ˆè¯¦è§£)
- [å¼€å‘ç¯å¢ƒé…ç½®](#å¼€å‘ç¯å¢ƒé…ç½®)
- [æ™ºèƒ½åˆçº¦å¼€å‘](#æ™ºèƒ½åˆçº¦å¼€å‘)
- [å‰ç«¯å¼€å‘](#å‰ç«¯å¼€å‘)
- [åç«¯å¼€å‘](#åç«¯å¼€å‘)
- [Farcaster Frames é›†æˆ](#farcaster-frames-é›†æˆ)
- [æµ‹è¯•ç­–ç•¥](#æµ‹è¯•ç­–ç•¥)
- [éƒ¨ç½²æµç¨‹](#éƒ¨ç½²æµç¨‹)
- [äº§å“åŠŸèƒ½è§„æ ¼](#äº§å“åŠŸèƒ½è§„æ ¼)
- [ç—…æ¯’å¢é•¿æœºåˆ¶](#ç—…æ¯’å¢é•¿æœºåˆ¶)
- [å®‰å…¨å®¡è®¡æ¸…å•](#å®‰å…¨å®¡è®¡æ¸…å•)
- [å¼€å‘è·¯çº¿å›¾](#å¼€å‘è·¯çº¿å›¾)

---

## æ¶æ„å®šç¨¿ä¸é‡è¦å˜æ›´ï¼ˆ2025-10 æ›´æ–°ï¼‰

- æ ¸å¿ƒæ¶æ„ï¼šå‰åç«¯ + é“¾ï¼ˆæ”¾å¼ƒ"æ— åç«¯/æç®€åç«¯"ï¼‰ã€‚
- å‰ç«¯ï¼šNext.js 14ã€React 18ã€TypeScriptã€Tailwindã€Neobrutalist UIã€Lucideã€Wagmi v2ã€RainbowKitã€Viemã€Zustandã€TanStack Queryã€React Hot Toastã€‚
- åç«¯ï¼šFastify 4ã€TypeScriptã€Zodã€Prisma ORMã€PostgreSQLã€Redisï¼ˆç¼“å­˜/ä¼šè¯/é˜Ÿåˆ—/Socket é€‚é…ï¼‰ã€Socket.IOï¼ˆRedis Adapter å¤šå®ä¾‹ï¼‰ã€‚
- é‰´æƒï¼šSIWEï¼ˆSign-In with Ethereumï¼‰+ JWTï¼›ä¸é»˜è®¤ä½¿ç”¨ Privyï¼ˆå¯ä½œä¸ºå¯é€‰æ‰©å±•ï¼‰ã€‚
- åŒºå—é“¾ï¼šSolidity 0.8.20ã€Foundryã€OpenZeppelinï¼›ç½‘ç»œä¼˜å…ˆ Ethereum Sepoliaï¼ˆæµ‹è¯•ï¼‰ï¼Œåç»­å†åˆ‡ä¸»ç½‘ï¼›SDK ä»¥ Viem ä¸ºä¸»ï¼ˆå¯é€‰ Ethersï¼‰ã€‚
- éƒ¨ç½²ï¼špnpm Monorepoã€Docker Compose + Nginxã€Railwayï¼ˆMVP/å†…æµ‹ï¼‰+ é¢„ç•™æ•°æ®åº“è¿ç§»åˆ° Neon/Supabase/Aiven/RDS çš„ç­–ç•¥ã€‚
- æ•°æ®åº“ç­–ç•¥ï¼ˆRailway é˜¶æ®µï¼‰ï¼š
  - è¿æ¥ä¸æ± åŒ–ï¼šå¯ç”¨ PgBouncerï¼ˆæˆ– Prisma è¿æ¥æ•°é™åˆ¶ï¼‰ï¼ŒAPI å±‚æŒ‡æ•°é€€é¿é‡è¯•ã€‚
  - å¤‡ä»½ï¼šå¼€å¯æ¯æ—¥è‡ªåŠ¨å¤‡ä»½ï¼›æ”¶å½• `pg_dump/pg_restore` è„šæœ¬ï¼ŒæŒ‰æœˆæ¼”ç»ƒæ¢å¤ã€‚
  - è¿ç§»ï¼šPrisma `migrate deploy` ä½œä¸ºå‘å¸ƒå‰ç½®æ­¥éª¤ï¼›è¾¾æˆé˜ˆå€¼ï¼ˆ>50GBã€>200â€“300rpsã€éœ€ PITR/åªè¯»å‰¯æœ¬ï¼‰æ—¶è¿ç§»åˆ°ä¸“ä¸š PGï¼ˆNeon/Supabase/Aiven/RDSï¼‰ã€‚
- Framesï¼šä¿ç•™åç«¯ä»£ç†é¢†å–ä¸åˆ†å¸ƒå¼é”/å¹‚ç­‰ï¼›ä¸å¤–éƒ¨é’±åŒ…ä¸»è·¯å¾„ä¸å†²çªã€‚

ï¼ˆä»¥ä¸‹åŸæ–‡æ¡£ç« èŠ‚å¦‚ä¸æœ¬èŠ‚ä¸ä¸€è‡´ï¼Œä»¥æœ¬èŠ‚ä¸ºå‡†ï¼›åç»­é€æ®µæ›¿æ¢åˆ°ä½ï¼‰

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®å®šä½
Base é“¾ä¸Šçš„ç¤¾äº¤çº¢åŒ… dApp,æ·±åº¦é›†æˆ Farcaster ç”Ÿæ€,å®ç°å¾®ä¿¡çº¢åŒ…å¼çš„ Web3 ç¤¾äº¤æ”¯ä»˜ä½“éªŒã€‚

### æ ¸å¿ƒä»·å€¼ä¸»å¼ 
- ğŸš€ **é›¶é—¨æ§›**: Account Abstraction æ—  Gas è´¹ä½“éªŒ
- âš¡ **é›¶è·³è½¬**: Farcaster Frames å†…å®Œæˆå…¨æµç¨‹
- ğŸ® **é«˜äº’åŠ¨**: æ¸¸æˆåŒ–è®¾è®¡ + ç¤¾äº¤è£‚å˜
- ğŸ’° **çœŸæ¿€åŠ±**: å‘çº¢åŒ…/æŠ¢çº¢åŒ…/é‚€è¯·å¥–åŠ±

### æŠ€æœ¯äº®ç‚¹
- EVM å…¼å®¹(å¯æ‰©å±•åˆ°å…¶ä»– L2)
- AA æ™ºèƒ½è´¦æˆ·(Privy/Biconomy)
- Farcaster Frames æ·±åº¦é›†æˆ
- å®æ—¶ WebSocket é€šçŸ¥
- é“¾ä¸Š+é“¾ä¸‹æ··åˆæ¶æ„

---

## æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ç”¨æˆ·å±‚                             â”‚
â”‚  Warpcast App  â”‚  Web dApp  â”‚  Mobile dApp (Future)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯å±‚ (Next.js)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Frame UI â”‚  â”‚ Web UI   â”‚  â”‚ Wallet   â”‚             â”‚
â”‚  â”‚ (Frog)   â”‚  â”‚ (React)  â”‚  â”‚ (Privy)  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åç«¯æœåŠ¡å±‚ (Node.js)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ API      â”‚  â”‚ WebSocketâ”‚  â”‚ Queue    â”‚             â”‚
â”‚  â”‚ Gateway  â”‚  â”‚ Server   â”‚  â”‚ (Bull)   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŒºå—é“¾å±‚ (Base)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ RedPacket.sol    â”‚  â”‚ AccountFactory   â”‚           â”‚
â”‚  â”‚ (æ ¸å¿ƒåˆçº¦)        â”‚  â”‚ (AA é’±åŒ…)        â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å±‚ (PostgreSQL)                   â”‚
â”‚  ç”¨æˆ·è¡¨ â”‚ çº¢åŒ…è¡¨ â”‚ é¢†å–è®°å½• â”‚ é‚€è¯·å…³ç³» â”‚ ç»Ÿè®¡æ•°æ®      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘

**å‘çº¢åŒ…æµç¨‹**:
```
ç”¨æˆ· â†’ Frame UI â†’ API Server â†’ åˆ›å»º AA Tx â†’ 
æ™ºèƒ½åˆçº¦(mint) â†’ æ•°æ®åº“è®°å½• â†’ WebSocket å¹¿æ’­ â†’ å…¶ä»–ç”¨æˆ·æ”¶åˆ°é€šçŸ¥
```

**æŠ¢çº¢åŒ…æµç¨‹**:
```
ç”¨æˆ· â†’ Frame ç‚¹å‡» â†’ API éªŒè¯(æœªé¢†å–?) â†’ 
æ™ºèƒ½åˆçº¦(claim) â†’ è½¬è´¦ USDC â†’ æ•°æ®åº“æ›´æ–° â†’ 
WebSocket æ¨é€ç»“æœ â†’ æ˜¾ç¤ºåŠ¨ç”»
```

---

## æŠ€æœ¯æ ˆè¯¦è§£

### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | å¤‡æ³¨ |
|------|------|------|------|
| **Next.js** | 14.x | React æ¡†æ¶ | App Router, SSR |
| **TypeScript** | 5.x | ç±»å‹å®‰å…¨ | å¼ºç±»å‹å¼€å‘ |
| **Tailwind CSS** | 3.x | æ ·å¼ | å¿«é€Ÿ UI å¼€å‘ |
| **Viem** | 2.x | EVM äº¤äº’ | æ›¿ä»£ ethers.js |
| **Wagmi** | 2.x | React Hooks | é’±åŒ…è¿æ¥ |
| **Privy** | latest | AA é’±åŒ… | é‚®ç®±ç™»å½•,æ—  Gas |
| **Frog** | latest | Frames å¼€å‘ | Farcaster å®˜æ–¹æ¨è |
| **Framer Motion** | latest | åŠ¨ç”» | çº¢åŒ…åŠ¨ç”»æ•ˆæœ |
| **Zustand** | 4.x | çŠ¶æ€ç®¡ç† | è½»é‡çº§ |
| **React Query** | 5.x | æ•°æ®è·å– | ç¼“å­˜ä¼˜åŒ– |
| **Socket.IO Client** | 4.x | å®æ—¶é€šä¿¡ | WebSocket |

### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | å¤‡æ³¨ |
|------|------|------|------|
| **Node.js** | 20.x LTS | è¿è¡Œç¯å¢ƒ | - |
| **Express** | 4.x | Web æ¡†æ¶ | RESTful API |
| **TypeScript** | 5.x | ç±»å‹å®‰å…¨ | - |
| **Prisma** | 5.x | ORM | æ•°æ®åº“æ“ä½œ |
| **PostgreSQL** | 16.x | ä¸»æ•°æ®åº“ | å…³ç³»å‹æ•°æ® |
| **Redis** | 7.x | ç¼“å­˜/é˜Ÿåˆ— | é«˜æ€§èƒ½ç¼“å­˜ |
| **Bull** | 4.x | ä»»åŠ¡é˜Ÿåˆ— | å¼‚æ­¥ä»»åŠ¡å¤„ç† |
| **Socket.IO** | 4.x | WebSocket | å®æ—¶æ¨é€ |
| **Viem** | 2.x | é“¾ä¸Šäº¤äº’ | åç«¯è°ƒç”¨åˆçº¦ |
| **JWT** | 9.x | èº«ä»½éªŒè¯ | Token è®¤è¯ |

### åŒºå—é“¾æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | å¤‡æ³¨ |
|------|------|------|------|
| **Solidity** | 0.8.24 | æ™ºèƒ½åˆçº¦ | æœ€æ–°ç¨³å®šç‰ˆ |
| **Foundry** | latest | åˆçº¦æ¡†æ¶ | ç¼–è¯‘/æµ‹è¯•/éƒ¨ç½² |
| **OpenZeppelin** | 5.x | åˆçº¦åº“ | å®‰å…¨æ ‡å‡†å®ç° |
| **Chainlink VRF** | v2.5 | éšæœºæ•° | å¯éªŒè¯éšæœº |
| **Base Mainnet** | - | éƒ¨ç½²é“¾ | L2 ä½æˆæœ¬ |
| **Base Sepolia** | - | æµ‹è¯•ç½‘ | å¼€å‘æµ‹è¯• |

### å¤–éƒ¨æœåŠ¡

| æœåŠ¡ | ç”¨é€” | å¤‡æ³¨ |
|------|------|------|
| **Alchemy** | RPC èŠ‚ç‚¹ | Base RPC æœåŠ¡ |
| **Privy** | AA é’±åŒ…æœåŠ¡ | æ‰˜ç®¡è´¦æˆ·æŠ½è±¡ |
| **Farcaster Hub** | ç¤¾äº¤æ•°æ® | ç”¨æˆ·å…³ç³»å›¾è°± |
| **Pinata/IPFS** | å­˜å‚¨ | NFT å…ƒæ•°æ® |
| **Vercel** | éƒ¨ç½² | å‰ç«¯æ‰˜ç®¡ |
| **Railway/Render** | éƒ¨ç½² | åç«¯æ‰˜ç®¡ |
| **Sentry** | ç›‘æ§ | é”™è¯¯è¿½è¸ª |

---

## å¼€å‘ç¯å¢ƒé…ç½®

### ç³»ç»Ÿè¦æ±‚

```bash
# æ“ä½œç³»ç»Ÿ
Ubuntu 22.04+ / macOS 13+ / Windows 11 WSL2

# è½¯ä»¶ç‰ˆæœ¬
Node.js: v20.x LTS
pnpm: v8.x+
Git: v2.40+
Docker: v24.x+ (å¯é€‰)
PostgreSQL: v16.x
Redis: v7.x
```

### ç¯å¢ƒå®‰è£…

#### 1. å®‰è£… Node.js å’Œ pnpm

```bash
# ä½¿ç”¨ nvm å®‰è£… Node.js
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20
nvm use 20

# å®‰è£… pnpm
npm install -g pnpm

# éªŒè¯
node -v  # v20.x.x
pnpm -v  # 8.x.x
```

#### 2. å®‰è£… Foundry (æ™ºèƒ½åˆçº¦)

```bash
# å®‰è£… Foundry
curl -L https://foundry.paradigm.xyz | bash
foundryup

# éªŒè¯
forge --version
cast --version
anvil --version
```

#### 3. å®‰è£…æ•°æ®åº“

```bash
# PostgreSQL (ä½¿ç”¨ Docker)
docker run --name redpacket-postgres \
  -e POSTGRES_PASSWORD=your_password \
  -e POSTGRES_DB=redpacket \
  -p 5432:5432 \
  -d postgres:16

# Redis (ä½¿ç”¨ Docker)
docker run --name redpacket-redis \
  -p 6379:6379 \
  -d redis:7-alpine

# æˆ–è€…æœ¬åœ°å®‰è£…
sudo apt install postgresql-16 redis-server  # Ubuntu
brew install postgresql@16 redis             # macOS
```

### é¡¹ç›®åˆå§‹åŒ–

#### 1. åˆ›å»ºé¡¹ç›®ç»“æ„

```bash
mkdir base-redpacket-dapp
cd base-redpacket-dapp

# åˆ›å»ºç›®å½•ç»“æ„
mkdir -p {contracts,frontend,backend,scripts,docs}

# åˆå§‹åŒ– Git
git init
```

#### 2. æ™ºèƒ½åˆçº¦é¡¹ç›®

```bash
cd contracts
forge init
pnpm init

# å®‰è£…ä¾èµ–
forge install OpenZeppelin/openzeppelin-contracts@v5.0.0
forge install smartcontractkit/chainlink@v2.5.0
```

**foundry.toml** é…ç½®:
```toml
[profile.default]
src = "src"
out = "out"
libs = ["lib"]
solc_version = "0.8.24"
optimizer = true
optimizer_runs = 200
via_ir = true

[rpc_endpoints]
base = "https://base-mainnet.g.alchemy.com/v2/${ALCHEMY_API_KEY}"
base_sepolia = "https://base-sepolia.g.alchemy.com/v2/${ALCHEMY_API_KEY}"

[etherscan]
base = { key = "${BASESCAN_API_KEY}", url = "https://api.basescan.org/api" }
base_sepolia = { key = "${BASESCAN_API_KEY}", url = "https://api-sepolia.basescan.org/api" }
```

#### 3. å‰ç«¯é¡¹ç›®

```bash
cd ../frontend
pnpm create next-app@latest . --typescript --tailwind --app --src-dir

# å®‰è£…æ ¸å¿ƒä¾èµ–
pnpm add viem wagmi @privy-io/react-auth @tanstack/react-query
pnpm add frog hono
pnpm add framer-motion zustand
pnpm add socket.io-client axios

# å¼€å‘ä¾èµ–
pnpm add -D @types/node prettier eslint
```

**tsconfig.json**:
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "jsx": "preserve",
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "allowJs": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "incremental": true,
    "paths": {
      "@/*": ["./src/*"]
    },
    "plugins": [{ "name": "next" }]
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

#### 4. åç«¯é¡¹ç›®

```bash
cd ../backend
pnpm init

# å®‰è£…ä¾èµ–
pnpm add express cors dotenv
pnpm add prisma @prisma/client
pnpm add socket.io redis bull
pnpm add viem jsonwebtoken bcrypt
pnpm add winston express-rate-limit helmet

# å¼€å‘ä¾èµ–
pnpm add -D typescript @types/node @types/express
pnpm add -D tsx nodemon prisma
```

**tsconfig.json**:
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "commonjs",
    "lib": ["ES2022"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "moduleResolution": "node",
    "types": ["node"]
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

**package.json scripts**:
```json
{
  "scripts": {
    "dev": "nodemon --exec tsx src/index.ts",
    "build": "tsc",
    "start": "node dist/index.js",
    "prisma:generate": "prisma generate",
    "prisma:migrate": "prisma migrate dev",
    "prisma:studio": "prisma studio"
  }
}
```

### ç¯å¢ƒå˜é‡é…ç½®

#### contracts/.env
```bash
# RPC
ALCHEMY_API_KEY=your_alchemy_api_key

# éƒ¨ç½²ç§é’¥ (ä»…æµ‹è¯•ç½‘ä½¿ç”¨,ä¸»ç½‘ç”¨ç¡¬ä»¶é’±åŒ…)
PRIVATE_KEY=your_private_key

# åŒºå—é“¾æµè§ˆå™¨
BASESCAN_API_KEY=your_basescan_api_key

# Chainlink VRF (Base Sepolia)
VRF_COORDINATOR=0x5C210eF41CD1a72de73bF76eC39637bB0d3d7BEE
VRF_KEY_HASH=0xd4bb89654db74673a187bd804519e65e3f71a52bc55f11da7601a13dcf505314
VRF_SUBSCRIPTION_ID=your_subscription_id
```

#### frontend/.env.local
```bash
# API
NEXT_PUBLIC_API_URL=http://localhost:3001
NEXT_PUBLIC_WS_URL=ws://localhost:3001

# é“¾é…ç½®
NEXT_PUBLIC_CHAIN_ID=8453  # Base Mainnet
# NEXT_PUBLIC_CHAIN_ID=84532  # Base Sepolia (æµ‹è¯•)

# Alchemy
NEXT_PUBLIC_ALCHEMY_API_KEY=your_alchemy_api_key

# Privy
NEXT_PUBLIC_PRIVY_APP_ID=your_privy_app_id

# åˆçº¦åœ°å€ (éƒ¨ç½²åå¡«å…¥)
NEXT_PUBLIC_RED_PACKET_CONTRACT=0x...
NEXT_PUBLIC_USDC_CONTRACT=0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913

# Farcaster
NEXT_PUBLIC_FARCASTER_DOMAIN=https://warpcast.com
```

#### backend/.env
```bash
# æœåŠ¡
NODE_ENV=development
PORT=3001

# æ•°æ®åº“
DATABASE_URL=postgresql://postgres:your_password@localhost:5432/redpacket
REDIS_URL=redis://localhost:6379

# JWT
JWT_SECRET=your_super_secret_jwt_key_min_32_chars
JWT_EXPIRES_IN=7d

# åŒºå—é“¾
CHAIN_ID=8453
RPC_URL=https://base-mainnet.g.alchemy.com/v2/${ALCHEMY_API_KEY}
ALCHEMY_API_KEY=your_alchemy_api_key

# åˆçº¦åœ°å€
RED_PACKET_CONTRACT=0x...
USDC_CONTRACT=0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913

# é’±åŒ… (æœåŠ¡ç«¯é’±åŒ…,ç”¨äº Gas ä»£ä»˜)
PAYMASTER_PRIVATE_KEY=your_paymaster_private_key

# Farcaster
FARCASTER_API_KEY=your_farcaster_api_key

# ç›‘æ§
SENTRY_DSN=your_sentry_dsn
```

---

## æ™ºèƒ½åˆçº¦å¼€å‘

### åˆçº¦æ¶æ„è®¾è®¡

```
contracts/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ RedPacket.sol          # ä¸»åˆçº¦
â”‚   â”œâ”€â”€ AccountFactory.sol     # AA è´¦æˆ·å·¥å‚(å¯é€‰)
â”‚   â””â”€â”€ interfaces/
â”‚       â””â”€â”€ IRedPacket.sol     # æ¥å£å®šä¹‰
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ RedPacket.t.sol        # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ RedPacket.integration.t.sol  # é›†æˆæµ‹è¯•
â””â”€â”€ script/
    â”œâ”€â”€ Deploy.s.sol           # éƒ¨ç½²è„šæœ¬
    â””â”€â”€ Upgrade.s.sol          # å‡çº§è„šæœ¬(å¦‚éœ€è¦)
```

### RedPacket.sol - æ ¸å¿ƒåˆçº¦

```solidity
// SPDX-License-Identifier: MIT
pragma solidity 0.8.24;

import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@chainlink/contracts/src/v0.8/vrf/VRFConsumerBaseV2.sol";
import "@chainlink/contracts/src/v0.8/vrf/interfaces/VRFCoordinatorV2Interface.sol";

/**
 * @title RedPacket
 * @notice çº¢åŒ…æ™ºèƒ½åˆçº¦ - æ”¯æŒéšæœºé‡‘é¢å’Œå›ºå®šé‡‘é¢ä¸¤ç§æ¨¡å¼
 * @dev ä½¿ç”¨ Chainlink VRF ç”Ÿæˆå¯éªŒè¯éšæœºæ•°
 */
contract RedPacket is ReentrancyGuard, Ownable, VRFConsumerBaseV2 {
    using SafeERC20 for IERC20;

    // ============ çŠ¶æ€å˜é‡ ============

    /// @notice çº¢åŒ…ç»“æ„ä½“
    struct Packet {
        address creator;           // åˆ›å»ºè€…
        address token;            // ä»£å¸åœ°å€(USDC)
        uint256 totalAmount;      // æ€»é‡‘é¢
        uint256 remainingAmount;  // å‰©ä½™é‡‘é¢
        uint32 totalCount;        // æ€»ä»½æ•°
        uint32 remainingCount;    // å‰©ä½™ä»½æ•°
        bool isRandom;            // æ˜¯å¦éšæœºé‡‘é¢
        uint256 expireTime;       // è¿‡æœŸæ—¶é—´
        uint256 minAmount;        // æœ€å°é‡‘é¢(éšæœºæ¨¡å¼)
        bool refunded;            // æ˜¯å¦å·²é€€æ¬¾
    }

    /// @notice é¢†å–è®°å½•
    struct Claim {
        address claimer;          // é¢†å–è€…
        uint256 amount;           // é¢†å–é‡‘é¢
        uint256 timestamp;        // é¢†å–æ—¶é—´
    }

    // çº¢åŒ…æ˜ å°„: packetId => Packet
    mapping(bytes32 => Packet) public packets;
    
    // é¢†å–è®°å½•: packetId => claimer => Claim
    mapping(bytes32 => mapping(address => Claim)) public claims;
    
    // çº¢åŒ…é¢†å–åˆ—è¡¨: packetId => claimer[]
    mapping(bytes32 => address[]) public claimers;

    // Chainlink VRF
    VRFCoordinatorV2Interface private immutable COORDINATOR;
    uint64 private immutable subscriptionId;
    bytes32 private immutable keyHash;
    uint32 private constant callbackGasLimit = 200000;
    uint16 private constant requestConfirmations = 3;
    uint32 private constant numWords = 1;

    // VRF è¯·æ±‚æ˜ å°„: requestId => packetId
    mapping(uint256 => bytes32) private vrfRequests;
    
    // éšæœºæ•°ç¼“å­˜: packetId => randomness
    mapping(bytes32 => uint256) private randomness;

    // å¹³å°æ‰‹ç»­è´¹ (basis points, 100 = 1%)
    uint256 public platformFee = 100; // 1%
    address public feeCollector;

    // çº¢åŒ…é…ç½®é™åˆ¶
    uint256 public constant MIN_AMOUNT = 0.01 ether; // 0.01 USDC
    uint256 public constant MAX_AMOUNT = 10000 ether; // 10,000 USDC
    uint32 public constant MAX_COUNT = 200;
    uint256 public constant MAX_DURATION = 7 days;

    // ============ äº‹ä»¶ ============

    event PacketCreated(
        bytes32 indexed packetId,
        address indexed creator,
        address token,
        uint256 totalAmount,
        uint32 totalCount,
        bool isRandom,
        uint256 expireTime
    );

    event PacketClaimed(
        bytes32 indexed packetId,
        address indexed claimer,
        uint256 amount,
        uint32 remainingCount
    );

    event PacketRefunded(
        bytes32 indexed packetId,
        address indexed creator,
        uint256 refundAmount
    );

    event RandomnessRequested(bytes32 indexed packetId, uint256 requestId);
    event RandomnessFulfilled(bytes32 indexed packetId, uint256 randomness);

    // ============ é”™è¯¯ ============

    error InvalidAmount();
    error InvalidCount();
    error InvalidDuration();
    error PacketNotFound();
    error PacketExpired();
    error PacketEmpty();
    error AlreadyClaimed();
    error NotCreator();
    error NotExpired();
    error AlreadyRefunded();
    error TransferFailed();
    error RandomnessNotReady();

    // ============ æ„é€ å‡½æ•° ============

    constructor(
        address _vrfCoordinator,
        uint64 _subscriptionId,
        bytes32 _keyHash,
        address _feeCollector
    ) VRFConsumerBaseV2(_vrfCoordinator) {
        COORDINATOR = VRFCoordinatorV2Interface(_vrfCoordinator);
        subscriptionId = _subscriptionId;
        keyHash = _keyHash;
        feeCollector = _feeCollector;
    }

    // ============ å¤–éƒ¨å‡½æ•° ============

    /**
     * @notice åˆ›å»ºçº¢åŒ…
     * @param token ä»£å¸åœ°å€(é€šå¸¸æ˜¯ USDC)
     * @param totalAmount æ€»é‡‘é¢
     * @param count çº¢åŒ…ä»½æ•°
     * @param isRandom æ˜¯å¦éšæœºé‡‘é¢
     * @param duration æœ‰æ•ˆæœŸ(ç§’)
     * @param salt ç›å€¼(ç”¨äºç”Ÿæˆå”¯ä¸€ ID)
     * @return packetId çº¢åŒ… ID
     */
    function createPacket(
        address token,
        uint256 totalAmount,
        uint32 count,
        bool isRandom,
        uint256 duration,
        bytes32 salt
    ) external nonReentrant returns (bytes32 packetId) {
        // å‚æ•°éªŒè¯
        if (totalAmount < MIN_AMOUNT || totalAmount > MAX_AMOUNT) {
            revert InvalidAmount();
        }
        if (count == 0 || count > MAX_COUNT) {
            revert InvalidCount();
        }
        if (duration == 0 || duration > MAX_DURATION) {
            revert InvalidDuration();
        }

        // è®¡ç®—æ‰‹ç»­è´¹
        uint256 fee = (totalAmount * platformFee) / 10000;
        uint256 netAmount = totalAmount - fee;

        // ç”Ÿæˆçº¢åŒ… ID
        packetId = keccak256(
            abi.encodePacked(msg.sender, block.timestamp, salt)
        );

        // å­˜å‚¨çº¢åŒ…ä¿¡æ¯
        packets[packetId] = Packet({
            creator: msg.sender,
            token: token,
            totalAmount: netAmount,
            remainingAmount: netAmount,
            totalCount: count,
            remainingCount: count,
            isRandom: isRandom,
            expireTime: block.timestamp + duration,
            minAmount: isRandom ? MIN_AMOUNT : netAmount / count,
            refunded: false
        });

        // è½¬å…¥ä»£å¸
        IERC20(token).safeTransferFrom(msg.sender, address(this), totalAmount);
        
        // è½¬æ‰‹ç»­è´¹
        if (fee > 0) {
            IERC20(token).safeTransfer(feeCollector, fee);
        }

        // å¦‚æœæ˜¯éšæœºæ¨¡å¼,è¯·æ±‚éšæœºæ•°
        if (isRandom) {
            _requestRandomness(packetId);
        }

        emit PacketCreated(
            packetId,
            msg.sender,
            token,
            netAmount,
            count,
            isRandom,
            block.timestamp + duration
        );

        return packetId;
    }

    /**
     * @notice é¢†å–çº¢åŒ…
     * @param packetId çº¢åŒ… ID
     * @return amount é¢†å–åˆ°çš„é‡‘é¢
     */
    function claimPacket(bytes32 packetId) 
        external 
        nonReentrant 
        returns (uint256 amount) 
    {
        Packet storage packet = packets[packetId];

        // éªŒè¯
        if (packet.creator == address(0)) revert PacketNotFound();
        if (block.timestamp > packet.expireTime) revert PacketExpired();
        if (packet.remainingCount == 0) revert PacketEmpty();
        if (claims[packetId][msg.sender].amount > 0) revert AlreadyClaimed();

        // è®¡ç®—é¢†å–é‡‘é¢
        if (packet.isRandom) {
            // éšæœºæ¨¡å¼
            if (randomness[packetId] == 0) revert RandomnessNotReady();
            amount = _calculateRandomAmount(packetId);
        } else {
            // å›ºå®šæ¨¡å¼
            amount = packet.remainingAmount / packet.remainingCount;
        }

        // æ›´æ–°çŠ¶æ€
        packet.remainingAmount -= amount;
        packet.remainingCount--;

        // è®°å½•é¢†å–
        claims[packetId][msg.sender] = Claim({
            claimer: msg.sender,
            amount: amount,
            timestamp: block.timestamp
        });
        claimers[packetId].push(msg.sender);

        // è½¬è´¦
        IERC20(packet.token).safeTransfer(msg.sender, amount);

        emit PacketClaimed(
            packetId,
            msg.sender,
            amount,
            packet.remainingCount
        );

        return amount;
    }

    /**
     * @notice é€€æ¬¾(è¿‡æœŸå,åˆ›å»ºè€…å¯å–å›å‰©ä½™é‡‘é¢)
     * @param packetId çº¢åŒ… ID
     */
    function refund(bytes32 packetId) external nonReentrant {
        Packet storage packet = packets[packetId];

        if (packet.creator != msg.sender) revert NotCreator();
        if (block.timestamp <= packet.expireTime) revert NotExpired();
        if (packet.refunded) revert AlreadyRefunded();

        uint256 refundAmount = packet.remainingAmount;
        if (refundAmount > 0) {
            packet.remainingAmount = 0;
            packet.refunded = true;

            IERC20(packet.token).safeTransfer(msg.sender, refundAmount);

            emit PacketRefunded(packetId, msg.sender, refundAmount);
        }
    }

    // ============ æŸ¥è¯¢å‡½æ•° ============

    /**
     * @notice æŸ¥è¯¢çº¢åŒ…è¯¦æƒ…
     */
    function getPacketInfo(bytes32 packetId) 
        external 
        view 
        returns (
            address creator,
            address token,
            uint256 totalAmount,
            uint256 remainingAmount,
            uint32 totalCount,
            uint32 remainingCount,
            bool isRandom,
            uint256 expireTime,
            bool refunded
        ) 
    {
        Packet memory packet = packets[packetId];
        return (
            packet.creator,
            packet.token,
            packet.totalAmount,
            packet.remainingAmount,
            packet.totalCount,
            packet.remainingCount,
            packet.isRandom,
            packet.expireTime,
            packet.refunded
        );
    }

    /**
     * @notice æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å·²é¢†å–
     */
    function hasClaimed(bytes32 packetId, address user) 
        external 
        view 
        returns (bool) 
    {
        return claims[packetId][user].amount > 0;
    }

    /**
     * @notice æŸ¥è¯¢çº¢åŒ…é¢†å–è€…åˆ—è¡¨
     */
    function getClaimers(bytes32 packetId) 
        external 
        view 
        returns (address[] memory) 
    {
        return claimers[packetId];
    }

    // ============ ç®¡ç†å‘˜å‡½æ•° ============

    function setPlatformFee(uint256 newFee) external onlyOwner {
        require(newFee <= 500, "Fee too high"); // æœ€é«˜ 5%
        platformFee = newFee;
    }

    function setFeeCollector(address newCollector) external onlyOwner {
        feeCollector = newCollector;
    }

    // ============ å†…éƒ¨å‡½æ•° ============

    function _requestRandomness(bytes32 packetId) internal {
        uint256 requestId = COORDINATOR.requestRandomWords(
            keyHash,
            subscriptionId,
            requestConfirmations,
            callbackGasLimit,
            numWords
        );
        vrfRequests[requestId] = packetId;
        emit RandomnessRequested(packetId, requestId);
    }

    function fulfillRandomWords(
        uint256 requestId,
        uint256[] memory randomWords
    ) internal override {
        bytes32 packetId = vrfRequests[requestId];
        randomness[packetId] = randomWords[0];
        emit RandomnessFulfilled(packetId, randomWords[0]);
    }

    function _calculateRandomAmount(bytes32 packetId) 
        internal 
        view 
        returns (uint256) 
    {
        Packet memory packet = packets[packetId];
        
        if (packet.remainingCount == 1) {
            // æœ€åä¸€ä¸ªçº¢åŒ…,ç»™å‰©ä½™æ‰€æœ‰é‡‘é¢
            return packet.remainingAmount;
        }

        // è®¡ç®—æœ€å¤§å¯é¢†å–é‡‘é¢(ç¡®ä¿å‰©ä½™äººæ•°èƒ½åˆ†åˆ°æœ€å°é‡‘é¢)
        uint256 maxAmount = packet.remainingAmount - 
            (packet.remainingCount - 1) * packet.minAmount;

        // ä½¿ç”¨éšæœºæ•°è®¡ç®—
        uint256 rand = uint256(
            keccak256(
                abi.encodePacked(
                    randomness[packetId],
                    msg.sender,
                    block.timestamp
                )
            )
        );

        uint256 amount = packet.minAmount + (rand % (maxAmount - packet.minAmount));
        
        return amount;
    }
}
```

### åˆçº¦æµ‹è¯•

**test/RedPacket.t.sol**:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity 0.8.24;

import "forge-std/Test.sol";
import "../src/RedPacket.sol";
import "@openzeppelin/contracts/token/ERC20/ERC20.sol";

contract MockERC20 is ERC20 {
    constructor() ERC20("Mock USDC", "USDC") {
        _mint(msg.sender, 1000000 * 10**18);
    }

    function mint(address to, uint256 amount) external {
        _mint(to, amount);
    }
}

contract MockVRFCoordinator {
    function requestRandomWords(
        bytes32,
        uint64,
        uint16,
        uint32,
        uint32
    ) external pure returns (uint256) {
        return 1; // Mock request ID
    }
}

contract RedPacketTest is Test {
    RedPacket public redPacket;
    MockERC20 public usdc;
    MockVRFCoordinator public vrfCoordinator;

    address public creator = address(1);
    address public claimer1 = address(2);
    address public claimer2 = address(3);
    address public feeCollector = address(4);

    function setUp() public {
        // éƒ¨ç½² Mock åˆçº¦
        usdc = new MockERC20();
        vrfCoordinator = new MockVRFCoordinator();

        // éƒ¨ç½²çº¢åŒ…åˆçº¦
        redPacket = new RedPacket(
            address(vrfCoordinator),
            1, // subscription ID
            bytes32(0), // key hash
            feeCollector
        );

        // ç»™æµ‹è¯•è´¦æˆ·è½¬å¸
        usdc.mint(creator, 10000 * 10**18);
        vm.deal(creator, 10 ether);
    }

    function testCreateFixedPacket() public {
        vm.startPrank(creator);
        
        uint256 totalAmount = 100 * 10**18; // 100 USDC
        uint32 count = 10;
        
        // æˆæƒ
        usdc.approve(address(redPacket), totalAmount);
        
        // åˆ›å»ºçº¢åŒ…
        bytes32 packetId = redPacket.createPacket(
            address(usdc),
            totalAmount,
            count,
            false, // å›ºå®šé‡‘é¢
            1 days,
            bytes32(uint256(1))
        );

        // éªŒè¯
        (
            address creator_,
            ,
            uint256 totalAmount_,
            ,
            uint32 totalCount_,
            uint32 remainingCount_,
            bool isRandom_,
            ,
        ) = redPacket.getPacketInfo(packetId);

        assertEq(creator_, creator);
        assertTrue(totalAmount_ > 0); // æ‰£é™¤æ‰‹ç»­è´¹å
        assertEq(totalCount_, count);
        assertEq(remainingCount_, count);
        assertFalse(isRandom_);
        
        vm.stopPrank();
    }

    function testClaimFixedPacket() public {
        // åˆ›å»ºçº¢åŒ…
        vm.startPrank(creator);
        usdc.approve(address(redPacket), 100 * 10**18);
        bytes32 packetId = redPacket.createPacket(
            address(usdc),
            100 * 10**18,
            10,
            false,
            1 days,
            bytes32(uint256(1))
        );
        vm.stopPrank();

        // é¢†å–çº¢åŒ…
        vm.prank(claimer1);
        uint256 amount1 = redPacket.claimPacket(packetId);
        
        // éªŒè¯
        assertTrue(amount1 > 0);
        assertTrue(redPacket.hasClaimed(packetId, claimer1));
        assertFalse(redPacket.hasClaimed(packetId, claimer2));
        
        // ç¬¬äºŒä¸ªäººé¢†å–
        vm.prank(claimer2);
        uint256 amount2 = redPacket.claimPacket(packetId);
        assertTrue(amount2 > 0);
        
        // å›ºå®šé‡‘é¢æ¨¡å¼,é‡‘é¢åº”è¯¥ç›¸åŒ
        assertEq(amount1, amount2);
    }

    function testCannotClaimTwice() public {
        // åˆ›å»ºçº¢åŒ…
        vm.startPrank(creator);
        usdc.approve(address(redPacket), 100 * 10**18);
        bytes32 packetId = redPacket.createPacket(
            address(usdc),
            100 * 10**18,
            10,
            false,
            1 days,
            bytes32(uint256(1))
        );
        vm.stopPrank();

        // ç¬¬ä¸€æ¬¡é¢†å–
        vm.prank(claimer1);
        redPacket.claimPacket(packetId);

        // ç¬¬äºŒæ¬¡é¢†å–åº”è¯¥å¤±è´¥
        vm.prank(claimer1);
        vm.expectRevert(RedPacket.AlreadyClaimed.selector);
        redPacket.claimPacket(packetId);
    }

    function testRefundAfterExpiry() public {
        // åˆ›å»ºçº¢åŒ…
        vm.startPrank(creator);
        usdc.approve(address(redPacket), 100 * 10**18);
        bytes32 packetId = redPacket.createPacket(
            address(usdc),
            100 * 10**18,
            10,
            false,
            1 days,
            bytes32(uint256(1))
        );
        
        // éƒ¨åˆ†é¢†å–
        vm.stopPrank();
        vm.prank(claimer1);
        redPacket.claimPacket(packetId);

        // æ—¶é—´å¿«è¿›åˆ°è¿‡æœŸå
        vm.warp(block.timestamp + 1 days + 1);

        // é€€æ¬¾
        vm.prank(creator);
        uint256 balanceBefore = usdc.balanceOf(creator);
        redPacket.refund(packetId);
        uint256 balanceAfter = usdc.balanceOf(creator);

        // éªŒè¯æ”¶åˆ°é€€æ¬¾
        assertTrue(balanceAfter > balanceBefore);
    }
}
```

### éƒ¨ç½²è„šæœ¬

**script/Deploy.s.sol**:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity 0.8.24;

import "forge-std/Script.sol";
import "../src/RedPacket.sol";

contract DeployScript is Script {
    function run() external {
        uint256 deployerPrivateKey = vm.envUint("PRIVATE_KEY");
        address vrfCoordinator = vm.envAddress("VRF_COORDINATOR");
        uint64 subscriptionId = uint64(vm.envUint("VRF_SUBSCRIPTION_ID"));
        bytes32 keyHash = vm.envBytes32("VRF_KEY_HASH");
        address feeCollector = vm.envAddress("FEE_COLLECTOR");

        vm.startBroadcast(deployerPrivateKey);

        RedPacket redPacket = new RedPacket(
            vrfCoordinator,
            subscriptionId,
            keyHash,
            feeCollector
        );

        console.log("RedPacket deployed to:", address(redPacket));

        vm.stopBroadcast();
    }
}
```

### ç¼–è¯‘å’Œæµ‹è¯•

```bash
cd contracts

# ç¼–è¯‘
forge build

# è¿è¡Œæµ‹è¯•
forge test -vvv

# æµ‹è¯•è¦†ç›–ç‡
forge coverage

# Gas æŠ¥å‘Š
forge test --gas-report

# éƒ¨ç½²åˆ°æµ‹è¯•ç½‘
forge script script/Deploy.s.sol --rpc-url base_sepolia --broadcast --verify

# éƒ¨ç½²åˆ°ä¸»ç½‘(ä½¿ç”¨ Ledger ç¡¬ä»¶é’±åŒ…)
forge script script/Deploy.s.sol --rpc-url base --ledger --broadcast --verify
```

---

## å‰ç«¯å¼€å‘

### é¡¹ç›®ç»“æ„

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                  # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ page.tsx         # ä¸»é¡µ
â”‚   â”‚   â”œâ”€â”€ create/page.tsx  # å‘çº¢åŒ…é¡µ
â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚       â””â”€â”€ frame/route.tsx  # Frame API
â”‚   â”œâ”€â”€ components/          # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ RedPacket/
â”‚   â”‚   â”‚   â”œâ”€â”€ CreateForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ClaimButton.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PacketCard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ PacketAnimation.tsx
â”‚   â”‚   â”œâ”€â”€ Wallet/
â”‚   â”‚   â”‚   â””â”€â”€ ConnectButton.tsx
â”‚   â”‚   â””â”€â”€ Layout/
â”‚   â”‚       â”œâ”€â”€ Header.tsx
â”‚   â”‚       â””â”€â”€ Footer.tsx
â”‚   â”œâ”€â”€ lib/                 # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ contracts/      # åˆçº¦ ABI å’Œåœ°å€
â”‚   â”‚   â”œâ”€â”€ privy.ts        # Privy é…ç½®
â”‚   â”‚   â”œâ”€â”€ wagmi.ts        # Wagmi é…ç½®
â”‚   â”‚   â”œâ”€â”€ api.ts          # API å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ socket.ts       # WebSocket å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ useRedPacket.ts
â”‚   â”‚   â”œâ”€â”€ useNotification.ts
â”‚   â”‚   â””â”€â”€ useInvite.ts
â”‚   â”œâ”€â”€ store/              # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ index.ts        # Zustand store
â”‚   â””â”€â”€ types/              # TypeScript ç±»å‹
â”‚       â””â”€â”€ index.ts
â””â”€â”€ public/
    â””â”€â”€ images/
```

### æ ¸å¿ƒé…ç½®æ–‡ä»¶

**(ç»­ä¸Šæ–‡...)**

**lib/wagmi.ts**:
```typescript
import { http, createConfig } from 'wagmi'
import { base, baseSepolia } from 'wagmi/chains'
import { coinbaseWallet, injected } from 'wagmi/connectors'

export const config = createConfig({
  chains: [base, baseSepolia],
  connectors: [
    injected(),
    coinbaseWallet({ appName: 'RedPacket dApp' }),
  ],
  transports: {
    [base.id]: http(
      `https://base-mainnet.g.alchemy.com/v2/${process.env.NEXT_PUBLIC_ALCHEMY_API_KEY}`
    ),
    [baseSepolia.id]: http(
      `https://base-sepolia.g.alchemy.com/v2/${process.env.NEXT_PUBLIC_ALCHEMY_API_KEY}`
    ),
  },
})
```

**lib/privy.ts**:
```typescript
import { PrivyClientConfig } from '@privy-io/react-auth'

export const privyConfig: PrivyClientConfig = {
  embeddedWallets: {
    createOnLogin: 'users-without-wallets',
    noPromptOnSignature: true,
  },
  loginMethods: ['email', 'google', 'farcaster'],
  appearance: {
    theme: 'light',
    accentColor: '#FF4444',
    logo: '/logo.png',
  },
  supportedChains: [base, baseSepolia],
}
```

**lib/contracts/RedPacket.ts**:
```typescript
import { Address } from 'viem'
import RedPacketABI from './abis/RedPacket.json'

export const RED_PACKET_ADDRESS: Address = 
  process.env.NEXT_PUBLIC_RED_PACKET_CONTRACT as Address

export const USDC_ADDRESS: Address = 
  '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913' // Base USDC

export { RedPacketABI }

// åˆçº¦äº¤äº’ç±»å‹
export type CreatePacketParams = {
  token: Address
  totalAmount: bigint
  count: number
  isRandom: boolean
  duration: number
  salt: `0x${string}`
}

export type PacketInfo = {
  creator: Address
  token: Address
  totalAmount: bigint
  remainingAmount: bigint
  totalCount: number
  remainingCount: number
  isRandom: boolean
  expireTime: bigint
  refunded: boolean
}
```

### æ ¸å¿ƒ Hook - useRedPacket

**hooks/useRedPacket.ts**:
```typescript
import { useWriteContract, useReadContract, useWaitForTransactionReceipt } from 'wagmi'
import { parseUnits, keccak256, toBytes } from 'viem'
import { RED_PACKET_ADDRESS, RedPacketABI, CreatePacketParams } from '@/lib/contracts/RedPacket'

export function useCreateRedPacket() {
  const { writeContract, data: hash, isPending } = useWriteContract()

  const createPacket = async (params: {
    amount: string // "10.5" USDC
    count: number
    isRandom: boolean
    duration: number // seconds
  }) => {
    const totalAmount = parseUnits(params.amount, 6) // USDC 6 decimals
    const salt = keccak256(toBytes(Date.now().toString()))

    return writeContract({
      address: RED_PACKET_ADDRESS,
      abi: RedPacketABI,
      functionName: 'createPacket',
      args: [
        USDC_ADDRESS, // token
        totalAmount,
        params.count,
        params.isRandom,
        params.duration,
        salt,
      ],
    })
  }

  return {
    createPacket,
    hash,
    isPending,
  }
}

export function useClaimRedPacket() {
  const { writeContract, data: hash, isPending } = useWriteContract()

  const claimPacket = (packetId: `0x${string}`) => {
    return writeContract({
      address: RED_PACKET_ADDRESS,
      abi: RedPacketABI,
      functionName: 'claimPacket',
      args: [packetId],
    })
  }

  return {
    claimPacket,
    hash,
    isPending,
  }
}

export function usePacketInfo(packetId: `0x${string}` | undefined) {
  const { data, isLoading, refetch } = useReadContract({
    address: RED_PACKET_ADDRESS,
    abi: RedPacketABI,
    functionName: 'getPacketInfo',
    args: packetId ? [packetId] : undefined,
  })

  return {
    packetInfo: data as PacketInfo | undefined,
    isLoading,
    refetch,
  }
}

export function useHasClaimed(packetId: `0x${string}` | undefined, address: Address | undefined) {
  const { data: hasClaimed } = useReadContract({
    address: RED_PACKET_ADDRESS,
    abi: RedPacketABI,
    functionName: 'hasClaimed',
    args: packetId && address ? [packetId, address] : undefined,
  })

  return hasClaimed as boolean | undefined
}
```

### å‘çº¢åŒ…ç»„ä»¶

**components/RedPacket/CreateForm.tsx**:
```typescript
'use client'

import { useState } from 'react'
import { useCreateRedPacket } from '@/hooks/useRedPacket'
import { usePrivy } from '@privy-io/react-auth'
import { formatUnits } from 'viem'
import { motion } from 'framer-motion'

export default function CreateRedPacketForm() {
  const { user, authenticated } = usePrivy()
  const { createPacket, isPending, hash } = useCreateRedPacket()

  const [amount, setAmount] = useState('')
  const [count, setCount] = useState(5)
  const [isRandom, setIsRandom] = useState(true)
  const [duration, setDuration] = useState(24 * 60 * 60) // 24 hours
  const [message, setMessage] = useState('')

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    
    try {
      await createPacket({
        amount,
        count,
        isRandom,
        duration,
      })
      
      // æˆåŠŸåçš„å¤„ç†
      toast.success('çº¢åŒ…åˆ›å»ºæˆåŠŸ!')
      // è°ƒç”¨åç«¯ API è®°å½•çº¢åŒ…ä¿¡æ¯
      await fetch('/api/packets/create', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          txHash: hash,
          message,
          amount,
          count,
          isRandom,
        }),
      })
    } catch (error) {
      toast.error('åˆ›å»ºå¤±è´¥: ' + error.message)
    }
  }

  const presetAmounts = [5, 10, 20, 50, 100]

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      className="max-w-md mx-auto bg-white rounded-2xl shadow-xl p-6"
    >
      <h2 className="text-2xl font-bold text-center mb-6">
        ğŸ§§ å‘çº¢åŒ…
      </h2>

      <form onSubmit={handleSubmit} className="space-y-4">
        {/* é‡‘é¢è¾“å…¥ */}
        <div>
          <label className="block text-sm font-medium mb-2">
            æ€»é‡‘é¢ (USDC)
          </label>
          <input
            type="number"
            step="0.01"
            min="0.01"
            max="10000"
            value={amount}
            onChange={(e) => setAmount(e.target.value)}
            className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-red-500"
            placeholder="è¾“å…¥é‡‘é¢"
            required
          />
          
          {/* å¿«æ·é‡‘é¢æŒ‰é’® */}
          <div className="flex gap-2 mt-2">
            {presetAmounts.map((preset) => (
              <button
                key={preset}
                type="button"
                onClick={() => setAmount(preset.toString())}
                className="flex-1 py-2 text-sm border rounded-lg hover:bg-gray-50"
              >
                ${preset}
              </button>
            ))}
          </div>
        </div>

        {/* çº¢åŒ…ä¸ªæ•° */}
        <div>
          <label className="block text-sm font-medium mb-2">
            çº¢åŒ…ä¸ªæ•°
          </label>
          <div className="flex items-center gap-4">
            <input
              type="range"
              min="1"
              max="200"
              value={count}
              onChange={(e) => setCount(Number(e.target.value))}
              className="flex-1"
            />
            <span className="text-lg font-bold w-12 text-center">
              {count}
            </span>
          </div>
        </div>

        {/* çº¢åŒ…ç±»å‹ */}
        <div>
          <label className="block text-sm font-medium mb-2">
            çº¢åŒ…ç±»å‹
          </label>
          <div className="flex gap-4">
            <button
              type="button"
              onClick={() => setIsRandom(true)}
              className={`flex-1 py-3 rounded-lg border-2 transition ${
                isRandom
                  ? 'border-red-500 bg-red-50 text-red-700'
                  : 'border-gray-300'
              }`}
            >
              ğŸ² æ‹¼æ‰‹æ°”
            </button>
            <button
              type="button"
              onClick={() => setIsRandom(false)}
              className={`flex-1 py-3 rounded-lg border-2 transition ${
                !isRandom
                  ? 'border-red-500 bg-red-50 text-red-700'
                  : 'border-gray-300'
              }`}
            >
              ğŸ’° æ™®é€š
            </button>
          </div>
          {!isRandom && amount && count && (
            <p className="text-sm text-gray-600 mt-2">
              æ¯ä¸ªçº¢åŒ… ${(Number(amount) / count).toFixed(2)} USDC
            </p>
          )}
        </div>

        {/* æœ‰æ•ˆæœŸ */}
        <div>
          <label className="block text-sm font-medium mb-2">
            æœ‰æ•ˆæœŸ
          </label>
          <select
            value={duration}
            onChange={(e) => setDuration(Number(e.target.value))}
            className="w-full px-4 py-3 border rounded-lg"
          >
            <option value={3600}>1 å°æ—¶</option>
            <option value={21600}>6 å°æ—¶</option>
            <option value={86400}>24 å°æ—¶</option>
            <option value={259200}>3 å¤©</option>
            <option value={604800}>7 å¤©</option>
          </select>
        </div>

        {/* ç¥ç¦è¯­ */}
        <div>
          <label className="block text-sm font-medium mb-2">
            ç¥ç¦è¯­(å¯é€‰)
          </label>
          <textarea
            value={message}
            onChange={(e) => setMessage(e.target.value)}
            maxLength={100}
            rows={3}
            className="w-full px-4 py-3 border rounded-lg resize-none"
            placeholder="æ­å–œå‘è´¢,å¤§å‰å¤§åˆ©!"
          />
        </div>

        {/* æ‰‹ç»­è´¹æç¤º */}
        <div className="bg-gray-50 p-3 rounded-lg text-sm text-gray-600">
          <div className="flex justify-between">
            <span>æ€»é‡‘é¢:</span>
            <span className="font-medium">${amount || '0'}</span>
          </div>
          <div className="flex justify-between">
            <span>å¹³å°æ‰‹ç»­è´¹ (1%):</span>
            <span className="font-medium">
              ${amount ? (Number(amount) * 0.01).toFixed(2) : '0'}
            </span>
          </div>
          <div className="flex justify-between text-base font-bold text-gray-900 mt-2 pt-2 border-t">
            <span>å®é™…å‘å‡º:</span>
            <span>
              ${amount ? (Number(amount) * 0.99).toFixed(2) : '0'}
            </span>
          </div>
        </div>

        {/* æäº¤æŒ‰é’® */}
        <button
          type="submit"
          disabled={isPending || !authenticated || !amount}
          className="w-full py-4 bg-gradient-to-r from-red-500 to-red-600 
                   text-white font-bold rounded-lg shadow-lg 
                   hover:from-red-600 hover:to-red-700 
                   disabled:opacity-50 disabled:cursor-not-allowed
                   transition-all transform hover:scale-[1.02]"
        >
          {isPending ? 'æ­£åœ¨åˆ›å»º...' : 'å¡é’±è¿›çº¢åŒ… ğŸ§§'}
        </button>
      </form>

      {/* äº¤æ˜“çŠ¶æ€ */}
      {hash && (
        <div className="mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
          <p className="text-sm text-green-800">
            äº¤æ˜“å·²æäº¤:{' '}
            <a
              href={`https://basescan.org/tx/${hash}`}
              target="_blank"
              rel="noopener noreferrer"
              className="underline"
            >
              æŸ¥çœ‹è¯¦æƒ…
            </a>
          </p>
        </div>
      )}
    </motion.div>
  )
}
```

### æŠ¢çº¢åŒ…ç»„ä»¶

**components/RedPacket/ClaimButton.tsx**:
```typescript
'use client'

import { useState, useEffect } from 'react'
import { motion, AnimatePresence } from 'framer-motion'
import { useClaimRedPacket, usePacketInfo, useHasClaimed } from '@/hooks/useRedPacket'
import { useAccount } from 'wagmi'
import { formatUnits } from 'viem'
import confetti from 'canvas-confetti'

interface ClaimButtonProps {
  packetId: `0x${string}`
}

export default function ClaimButton({ packetId }: ClaimButtonProps) {
  const { address } = useAccount()
  const { claimPacket, isPending, hash } = useClaimRedPacket()
  const { packetInfo, refetch } = usePacketInfo(packetId)
  const hasClaimed = useHasClaimed(packetId, address)

  const [isOpen, setIsOpen] = useState(false)
  const [claimedAmount, setClaimedAmount] = useState<string | null>(null)

  const handleClaim = async () => {
    try {
      const tx = await claimPacket(packetId)
      
      // ç­‰å¾…äº¤æ˜“ç¡®è®¤
      // ä»äº‹ä»¶ä¸­è·å–é¢†å–é‡‘é¢
      // è¿™é‡Œç®€åŒ–å¤„ç†,å®é™…åº”è¯¥ç›‘å¬åˆçº¦äº‹ä»¶
      
      refetch() // åˆ·æ–°çº¢åŒ…ä¿¡æ¯
      
      // æ’­æ”¾åŠ¨ç”»
      setIsOpen(true)
      setTimeout(() => {
        confetti({
          particleCount: 100,
          spread: 70,
          origin: { y: 0.6 }
        })
        // æ¨¡æ‹Ÿè·å–é‡‘é¢(å®é™…åº”ä»äº‹ä»¶ä¸­è·å–)
        setClaimedAmount('0.88')
      }, 1000)
      
    } catch (error) {
      console.error('Claim failed:', error)
    }
  }

  if (!packetInfo) return null

  const isExpired = Number(packetInfo.expireTime) * 1000 < Date.now()
  const isEmpty = packetInfo.remainingCount === 0
  const canClaim = !hasClaimed && !isExpired && !isEmpty && address

  return (
    <>
      <motion.button
        onClick={handleClaim}
        disabled={!canClaim || isPending}
        whileHover={{ scale: 1.05 }}
        whileTap={{ scale: 0.95 }}
        className={`
          relative w-32 h-32 rounded-full
          ${canClaim ? 'bg-gradient-to-br from-red-500 to-red-700' : 'bg-gray-400'}
          shadow-2xl flex items-center justify-center
          disabled:cursor-not-allowed
          transition-all duration-300
        `}
      >
        <motion.div
          animate={canClaim ? { rotate: [0, -10, 10, -10, 0] } : {}}
          transition={{ repeat: Infinity, duration: 2 }}
          className="text-6xl"
        >
          ğŸ§§
        </motion.div>
        
        {isPending && (
          <div className="absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 rounded-full">
            <div className="animate-spin rounded-full h-8 w-8 border-4 border-white border-t-transparent" />
          </div>
        )}
      </motion.button>

      {/* çº¢åŒ…çŠ¶æ€æç¤º */}
      <div className="text-center mt-4 space-y-1">
        {hasClaimed && (
          <p className="text-green-600 font-medium">âœ… å·²é¢†å–</p>
        )}
        {isEmpty && (
          <p className="text-gray-600">ğŸ™ˆ æ‰‹æ…¢äº†,è¢«æŠ¢å…‰äº†</p>
        )}
        {isExpired && (
          <p className="text-gray-600">â° çº¢åŒ…å·²è¿‡æœŸ</p>
        )}
        {canClaim && (
          <p className="text-gray-700">
            è¿˜å‰© <span className="font-bold text-red-600">
              {packetInfo.remainingCount}
            </span> ä¸ª
          </p>
        )}
      </div>

      {/* å¼€çº¢åŒ…åŠ¨ç”» Modal */}
      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
            onClick={() => setIsOpen(false)}
          >
            <motion.div
              initial={{ scale: 0, rotate: -180 }}
              animate={{ scale: 1, rotate: 0 }}
              exit={{ scale: 0, rotate: 180 }}
              transition={{ type: 'spring', duration: 0.5 }}
              className="bg-gradient-to-br from-red-500 to-red-700 p-8 rounded-3xl shadow-2xl text-white text-center"
              onClick={(e) => e.stopPropagation()}
            >
              <motion.div
                animate={{ scale: [1, 1.2, 1] }}
                transition={{ repeat: Infinity, duration: 1 }}
                className="text-8xl mb-4"
              >
                ğŸ§§
              </motion.div>
              
              <h2 className="text-3xl font-bold mb-2">æ­å–œ!</h2>
              
              {claimedAmount && (
                <motion.div
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  className="text-6xl font-bold my-6"
                >
                  ${claimedAmount}
                </motion.div>
              )}
              
              <p className="text-xl opacity-90">USDC å·²åˆ°è´¦</p>
              
              <button
                onClick={() => setIsOpen(false)}
                className="mt-6 px-8 py-3 bg-white text-red-600 rounded-full font-bold hover:bg-gray-100 transition"
              >
                æŸ¥çœ‹è¯¦æƒ…
              </button>
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>
    </>
  )
}
```

### App Layout with Providers

**app/layout.tsx**:
```typescript
import './globals.css'
import { Inter } from 'next/font/google'
import { Providers } from './providers'

const inter = Inter({ subsets: ['latin'] })

export const metadata = {
  title: 'RedPacket - Web3 çº¢åŒ… dApp',
  description: 'åœ¨ Base é“¾ä¸Šå‘é€åŠ å¯†çº¢åŒ…',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <body className={inter.className}>
        <Providers>{children}</Providers>
      </body>
    </html>
  )
}
```

**app/providers.tsx**:
```typescript
'use client'

import { WagmiProvider } from 'wagmi'
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
import { PrivyProvider } from '@privy-io/react-auth'
import { config } from '@/lib/wagmi'
import { privyConfig } from '@/lib/privy'
import { Toaster } from 'react-hot-toast'

const queryClient = new QueryClient()

export function Providers({ children }: { children: React.ReactNode }) {
  return (
    <PrivyProvider
      appId={process.env.NEXT_PUBLIC_PRIVY_APP_ID!}
      config={privyConfig}
    >
      <WagmiProvider config={config}>
        <QueryClientProvider client={queryClient}>
          {children}
          <Toaster position="top-center" />
        </QueryClientProvider>
      </WagmiProvider>
    </PrivyProvider>
  )
}
```

---

## Farcaster Frames é›†æˆ

### Frame API Route

**app/api/frame/route.tsx**:
```typescript
import { Button, Frog } from 'frog'
import { handle } from 'frog/next'
import { Redis } from 'ioredis'

const redis = new Redis(process.env.REDIS_URL!)

export const app = new Frog({
  basePath: '/api/frame',
  title: 'RedPacket',
  imageOptions: {
    width: 1200,
    height: 630,
  },
})

// ä¸» Frame - æ˜¾ç¤ºçº¢åŒ…
app.frame('/:packetId', async (c) => {
  const { packetId } = c.req.param()
  
  // ä»æ•°æ®åº“æˆ–ç¼“å­˜è·å–çº¢åŒ…ä¿¡æ¯
  const packet = await getPacketInfo(packetId)
  
  if (!packet) {
    return c.res({
      image: (
        <div style={{ display: 'flex', flexDirection: 'column', ... }}>
          <h1>çº¢åŒ…ä¸å­˜åœ¨</h1>
        </div>
      ),
    })
  }

  const { creator, message, remainingCount, totalCount } = packet

  return c.res({
    image: (
      <div
        style={{
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          background: 'linear-gradient(135deg, #FF6B6B 0%, #FF4444 100%)',
          width: '100%',
          height: '100%',
          padding: '40px',
          color: 'white',
          fontFamily: 'sans-serif',
        }}
      >
        <div style={{ fontSize: 80, marginBottom: 20 }}>ğŸ§§</div>
        <div style={{ fontSize: 40, fontWeight: 'bold', marginBottom: 10 }}>
          {creator} å‘äº†çº¢åŒ…
        </div>
        <div style={{ fontSize: 24, opacity: 0.9, marginBottom: 40 }}>
          {message || 'æ­å–œå‘è´¢,å¤§å‰å¤§åˆ©!'}
        </div>
        <div style={{ fontSize: 32 }}>
          è¿˜å‰© {remainingCount}/{totalCount} ä¸ª
        </div>
      </div>
    ),
    intents: [
      <Button action={`/claim/${packetId}`}>
        æŠ¢çº¢åŒ… ğŸ
      </Button>,
      <Button action={`/details/${packetId}`}>
        æŸ¥çœ‹è¯¦æƒ…
      </Button>,
      <Button.Link href={`https://yourapp.com/packet/${packetId}`}>
        æ‰“å¼€ dApp
      </Button.Link>,
    ],
  })
})

// é¢†å– Frame
app.frame('/claim/:packetId', async (c) => {
  const { packetId } = c.req.param()
  const { fid } = c.frameData || {}
  
  if (!fid) {
    return c.res({
      image: <div>è¯·å…ˆç™»å½• Farcaster</div>,
    })
  }

  // éªŒè¯ç”¨æˆ·æ˜¯å¦å·²é¢†å–
  const userAddress = await getUserAddressFromFid(fid)
  const hasClaimed = await checkIfClaimed(packetId, userAddress)

  if (hasClaimed) {
    return c.res({
      image: <div>ä½ å·²ç»é¢†å–è¿‡äº†!</div>,
      intents: [
        <Button action={`/${packetId}`}>è¿”å›</Button>,
      ],
    })
  }

  // æ‰§è¡Œé“¾ä¸Šé¢†å–(è¿™é‡Œéœ€è¦åç«¯ä»£ç†)
  try {
    const result = await claimPacketOnChain(packetId, userAddress)
    const amount = result.amount

    return c.res({
      image: (
        <div style={{ /* æˆåŠŸæ ·å¼ */ }}>
          <div style={{ fontSize: 80 }}>ğŸ‰</div>
          <div style={{ fontSize: 48 }}>æ­å–œ!</div>
          <div style={{ fontSize: 60, fontWeight: 'bold' }}>
            ${amount} USDC
          </div>
        </div>
      ),
      intents: [
        <Button action={`/${packetId}`}>ç»§ç»­æŠ¢</Button>,
        <Button.Link href="https://yourapp.com">
          æŸ¥çœ‹ä½™é¢
        </Button.Link>,
      ],
    })
  } catch (error) {
    return c.res({
      image: <div>é¢†å–å¤±è´¥: {error.message}</div>,
      intents: [
        <Button action={`/${packetId}`}>é‡è¯•</Button>,
      ],
    })
  }
})

// è¯¦æƒ… Frame
app.frame('/details/:packetId', async (c) => {
  const { packetId } = c.req.param()
  const packet = await getPacketDetails(packetId)
  const claimers = await getClaimers(packetId)

  return c.res({
    image: (
      <div style={{ /* è¯¦æƒ…æ ·å¼ */ }}>
        <h2>é¢†å–è®°å½•</h2>
        {claimers.slice(0, 5).map((claim, i) => (
          <div key={i}>
            {claim.user}: ${claim.amount}
            {claim.isBest && ' ğŸ‘‘ æ‰‹æ°”æœ€ä½³'}
          </div>
        ))}
      </div>
    ),
    intents: [
      <Button action={`/${packetId}`}>è¿”å›</Button>,
    ],
  })
})

export const GET = handle(app)
export const POST = handle(app)
```

### Frame è¾…åŠ©å‡½æ•°

**lib/frame-utils.ts**:
```typescript
import { kv } from '@vercel/kv' // æˆ–ä½¿ç”¨ Redis
import { createPublicClient, http } from 'viem'
import { base } from 'viem/chains'

const client = createPublicClient({
  chain: base,
  transport: http(process.env.RPC_URL),
})

export async function getPacketInfo(packetId: string) {
  // å…ˆä»ç¼“å­˜è¯»å–
  const cached = await kv.get(`packet:${packetId}`)
  if (cached) return cached

  // ä»é“¾ä¸Šè¯»å–
  const data = await client.readContract({
    address: process.env.RED_PACKET_CONTRACT!,
    abi: RedPacketABI,
    functionName: 'getPacketInfo',
    args: [packetId as `0x${string}`],
  })

  // ç¼“å­˜5åˆ†é’Ÿ
  await kv.set(`packet:${packetId}`, data, { ex: 300 })
  
  return data
}

export async function getUserAddressFromFid(fid: number): Promise<string> {
  // è°ƒç”¨ Farcaster Hub API
  const response = await fetch(
    `https://hub.farcaster.xyz/v1/verificationsByFid?fid=${fid}`
  )
  const data = await response.json()
  
  // è¿”å›ç”¨æˆ·çš„ä»¥å¤ªåŠåœ°å€
  return data.messages[0]?.data?.verificationAddAddressBody?.address || null
}

export async function claimPacketOnChain(
  packetId: string,
  userAddress: string
) {
  // è°ƒç”¨åç«¯ API ä»£ç†é¢†å–(å› ä¸º Frame æ— æ³•ç›´æ¥å‘äº¤æ˜“)
  const response = await fetch(`${process.env.API_URL}/api/claim`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ packetId, userAddress }),
  })

  return response.json()
}
```

### åœ¨ Warpcast ä¸­åˆ†äº«

**components/ShareToWarpcast.tsx**:
```typescript
'use client'

export function ShareToWarpcast({ packetId }: { packetId: string }) {
  const frameUrl = `https://yourapp.com/api/frame/${packetId}`
  const text = encodeURIComponent('æˆ‘å‘äº†ä¸€ä¸ªçº¢åŒ…!å¿«æ¥æŠ¢!')
  const warpcastUrl = `https://warpcast.com/~/compose?text=${text}&embeds[]=${frameUrl}`

  return (
    <a
      href={warpcastUrl}
      target="_blank"
      rel="noopener noreferrer"
      className="flex items-center gap-2 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition"
    >
      <span>åˆ†äº«åˆ° Warpcast</span>
      <svg className="w-5 h-5" /* Farcaster logo SVG */ />
    </a>
  )
}
```

---

## åç«¯å¼€å‘

### é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ database.ts       # Prisma é…ç½®
â”‚   â”‚   â”œâ”€â”€ redis.ts          # Redis è¿æ¥
â”‚   â”‚   â””â”€â”€ blockchain.ts     # Web3 é…ç½®
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ packets.ts        # çº¢åŒ…è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ users.ts          # ç”¨æˆ·è·¯ç”±
â”‚   â”‚   â””â”€â”€ stats.ts          # ç»Ÿè®¡è·¯ç”±
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ packet.controller.ts
â”‚   â”‚   â””â”€â”€ user.controller.ts
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ blockchain.service.ts  # é“¾ä¸Šäº¤äº’
â”‚   â”‚   â”œâ”€â”€ packet.service.ts      # çº¢åŒ…ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ notification.service.ts # æ¨é€æœåŠ¡
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.middleware.ts
â”‚   â”‚   â”œâ”€â”€ rateLimit.middleware.ts
â”‚   â”‚   â””â”€â”€ validation.middleware.ts
â”‚   â”œâ”€â”€ jobs/
â”‚   â”‚   â”œâ”€â”€ syncPackets.job.ts    # åŒæ­¥é“¾ä¸Šæ•°æ®
â”‚   â”‚   â””â”€â”€ sendNotifications.job.ts
â”‚   â”œâ”€â”€ websocket/
â”‚   â”‚   â””â”€â”€ index.ts              # WebSocket æœåŠ¡å™¨
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ logger.ts
â”‚       â””â”€â”€ errors.ts
â””â”€â”€ prisma/
    â””â”€â”€ schema.prisma
```

### Prisma Schema

**prisma/schema.prisma**:
```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  address       String    @unique
  farcasterFid  Int?      @unique
  farcasterName String?
  email         String?   @unique
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // å…³ç³»
  createdPackets Packet[]  @relation("CreatedPackets")
  claims         Claim[]
  inviter        User?     @relation("Invitations", fields: [inviterId], references: [id])
  inviterId      String?
  invited        User[]    @relation("Invitations")

  @@index([address])
  @@index([farcasterFid])
}

model Packet {
  id                String    @id @default(cuid())
  packetId          String    @unique // é“¾ä¸Š ID
  txHash            String    @unique
  
  // åŸºæœ¬ä¿¡æ¯
  creatorId         String
  creator           User      @relation("CreatedPackets", fields: [creatorId], references: [id])
  token             String    // USDC address
  totalAmount       String    // BigInt as String
  count             Int
  isRandom          Boolean
  message           String?
  
  // çŠ¶æ€
  remainingAmount   String
  remainingCount    Int
  expireTime        DateTime
  refunded          Boolean   @default(false)
  
  // å…ƒæ•°æ®
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // å…³ç³»
  claims            Claim[]

  @@index([creatorId])
  @@index([expireTime])
  @@index([createdAt])
}

model Claim {
  id          String    @id @default(cuid())
  
  // å…³è”
  packetId    String
  packet      Packet    @relation(fields: [packetId], references: [id])
  userId      String
  user        User      @relation(fields: [userId], references: [id])
  
  // é¢†å–ä¿¡æ¯
  amount      String    // BigInt as String
  txHash      String    @unique
  isBest      Boolean   @default(false) // æ˜¯å¦æ‰‹æ°”æœ€ä½³
  
  // æ—¶é—´
  claimedAt   DateTime  @default(now())

  @@unique([packetId, userId])
  @@index([packetId])
  @@index([userId])
  @@index([claimedAt])
}

model Invitation {
  id          String    @id @default(cuid())
  inviterId   String
  inviteeId   String
  rewardPaid  Boolean   @default(false)
  createdAt   DateTime  @default(now())

  @@unique([inviterId, inviteeId])
  @@index([inviterId])
  @@index([inviteeId])
}

model Notification {
  id        String    @id @default(cuid())
  userId    String
  type      String    // "packet_created", "packet_claimed", etc.
  title     String
  content   String
  data      Json?     // é¢å¤–æ•°æ®
  read      Boolean   @default(false)
  createdAt DateTime  @default(now())

  @@index([userId, read])
  @@index([createdAt])
}
```

### ä¸»å…¥å£æ–‡ä»¶

**src/index.ts**:
```typescript
import express from 'express'
import cors from 'cors'
import helmet from 'helmet'
import { createServer } from 'http'
import { Server as SocketIOServer } from 'socket.io'
import { PrismaClient } from '@prisma/client'
import { createBullBoard } from '@bull-board/api'
import { BullAdapter } from '@bull-board/api/bullAdapter'
import { ExpressAdapter } from '@bull-board/express'

// Routes
import authRoutes from './routes/auth'
import packetRoutes from './routes/packets'
import userRoutes from './routes/users'
import statsRoutes from './routes/stats'

// Middleware
import { errorHandler } from './middleware/errorHandler'
import { authMiddleware } from './middleware/auth.middleware'
import { rateLimitMiddleware } from './middleware/rateLimit.middleware'

// Services
import { initWebSocket } from './websocket'
import { initJobs, packetSyncQueue } from './jobs'
import logger from './utils/logger'

const app = express()
const httpServer = createServer(app)
const io = new SocketIOServer(httpServer, {
  cors: {
    origin: process.env.FRONTEND_URL || 'http://localhost:3000',
    credentials: true,
  },
})

// Prisma Client
export const prisma = new PrismaClient()

// Middleware
app.use(helmet())
app.use(cors({
  origin: process.env.FRONTEND_URL || 'http://localhost:3000',
  credentials: true,
}))
app.use(express.json())
app.use(rateLimitMiddleware)

// Bull Board (ä»»åŠ¡é˜Ÿåˆ—ç›‘æ§)
const serverAdapter = new ExpressAdapter()
serverAdapter.setBasePath('/admin/queues')
createBullBoard({
  queues: [new BullAdapter(packetSyncQueue)],
  serverAdapter,
})
app.use('/admin/queues', serverAdapter.getRouter())

// Routes
app.use('/api/auth', authRoutes)
app.use('/api/packets', authMiddleware, packetRoutes)
app.use('/api/users', authMiddleware, userRoutes)
app.use('/api/stats', statsRoutes)

// Health check
app.get('/health', (req, res) => {
  res.json({ status: 'ok', timestamp: new Date().toISOString() })
})

// Error handling
app.use(errorHandler)

// Initialize WebSocket
initWebSocket(io)

// Initialize Jobs
initJobs()

// Start server
const PORT = process.env.PORT || 3001
httpServer.listen(PORT, () => {
  logger.info(`Server running on port ${PORT}`)
  logger.info(`Bull Board: http://localhost:${PORT}/admin/queues`)
})

// Graceful shutdown
process.on('SIGTERM', async () => {
  logger.info('SIGTERM received, closing server...')
  await prisma.$disconnect()
  httpServer.close(() => {
    logger.info('Server closed')
    process.exit(0)
  })
})
```

### çº¢åŒ…è·¯ç”±

**src/routes/packets.ts**:
```typescript
import { Router } from 'express'
import { body, param, query } from 'express-validator'
import { validate } from '../middleware/validation.middleware'
import * as packetController from '../controllers/packet.controller'

const router = Router()

// åˆ›å»ºçº¢åŒ…(é“¾ä¸Šäº¤æ˜“å,è®°å½•åˆ°æ•°æ®åº“)
router.post(
  '/create',
  [
    body('txHash').isString().notEmpty(),
    body('packetId').isString().notEmpty(),
    body('message').optional().isString().isLength({ max: 100 }),
    body('amount').isString().notEmpty(),
    body('count').isInt({ min: 1, max: 200 }),
    body('isRandom').isBoolean(),
    validate,
  ],
  packetController.createPacket
)

// é¢†å–çº¢åŒ…(åç«¯ä»£ç†)
router.post(
  '/claim',
  [
    body('packetId').isString().notEmpty(),
    validate,
  ],
  packetController.claimPacket
)

// æŸ¥è¯¢çº¢åŒ…è¯¦æƒ…
router.get(
  '/:packetId',
  [
    param('packetId').isString().notEmpty(),
    validate,
  ],
  packetController.getPacket
)

// æŸ¥è¯¢çº¢åŒ…é¢†å–è®°å½•
router.get(
  '/:packetId/claims',
  [
    param('packetId').isString().notEmpty(),
    query('page').optional().isInt({ min: 1 }).toInt(),
    query('limit').optional().isInt({ min: 1, max: 100 }).toInt(),
    validate,
  ],
  packetController.getPacketClaims
)

// æŸ¥è¯¢ç”¨æˆ·åˆ›å»ºçš„çº¢åŒ…
router.get(
  '/user/created',
  [
    query('page').optional().isInt({ min: 1 }).toInt(),
    query('limit').optional().isInt({ min: 1, max: 100 }).toInt(),
    validate,
  ],
  packetController.getUserCreatedPackets
)

// æŸ¥è¯¢ç”¨æˆ·é¢†å–çš„çº¢åŒ…
router.get(
  '/user/claimed',
  [
    query('page').optional().isInt({ min: 1 }).toInt(),
    query('limit').optional().isInt({ min: 1, max: 100 }).toInt(),
    validate,
  ],
  packetController.getUserClaimedPackets
)

// é€€æ¬¾
router.post(
  '/:packetId/refund',
  [
    param('packetId').isString().notEmpty(),
    validate,
  ],
  packetController.refundPacket
)

export default router
```

### çº¢åŒ…æ§åˆ¶å™¨

**src/controllers/packet.controller.ts**:
```typescript
import { Request, Response, NextFunction } from 'express'
import * as packetService from '../services/packet.service'
import { AppError } from '../utils/errors'
import logger from '../utils/logger'

export async function createPacket(
  req: Request,
  res: Response,
  next: NextFunction
) {
  try {
    const userId = req.user!.id
    const { txHash, packetId, message, amount, count, isRandom } = req.body

    // éªŒè¯äº¤æ˜“æ˜¯å¦å­˜åœ¨ä¸”æˆåŠŸ
    const txValid = await packetService.verifyTransaction(txHash)
    if (!txValid) {
      throw new AppError('Invalid transaction', 400)
    }

    // åˆ›å»ºè®°å½•
    const packet = await packetService.createPacket({
      userId,
      txHash,
      packetId,
      message,
      amount,
      count,
      isRandom,
    })

    // å‘é€é€šçŸ¥ç»™å…³æ³¨è€…
    await packetService.notifyFollowers(userId, packet.id)

    res.status(201).json({
      success: true,
      data: packet,
    })
  } catch (error) {
    next(error)
  }
}

export async function claimPacket(
  req: Request,
  res: Response,
  next: NextFunction
) {
  try {
    const userId = req.user!.id
    const { packetId } = req.body

    // éªŒè¯æ˜¯å¦å¯ä»¥é¢†å–
    const canClaim = await packetService.canClaim(packetId, userId)
    if (!canClaim) {
      throw new AppError('Cannot claim this packet', 400)
    }

    // æ‰§è¡Œé¢†å–(è°ƒç”¨æ™ºèƒ½åˆçº¦)
    const claim = await packetService.claimPacket(packetId, userId)

    res.json({
      success: true,
      data: claim,
    })
  } catch (error) {
    next(error)
  }
}

export async function getPacket(
  req: Request,
  res: Response,
  next: NextFunction
) {
  try {
    const { packetId } = req.params

    const packet = await packetService.getPacket(packetId)
    if (!packet) {
      throw new AppError('Packet not found', 404)
    }

    res.json({
      success: true,
      data: packet,
    })
  } catch (error) {
    next(error)
  }
}

export async function getPacketClaims(
  req: Request,
  res: Response,
  next: NextFunction
) {
  try {
    const { packetId } = req.params
    const page = req.query.page ? parseInt(req.query.page as string) : 1
    const limit = req.query.limit ? parseInt(req.query.limit as string) : 20

    const claims = await packetService.getPacketClaims(packetId, page, limit)

    res.json({
      success: true,
      data: claims,
    })
  } catch (error) {
    next(error)
  }
}

// ... å…¶ä»–æ§åˆ¶å™¨å‡½æ•°
```

### WebSocket æœåŠ¡

**src/websocket/index.ts**:
```typescript
import { Server as SocketIOServer, Socket } from 'socket.io'
import { verifyJWT } from '../utils/jwt'
import logger from '../utils/logger'

interface AuthenticatedSocket extends Socket {
  userId?: string
}

export function initWebSocket(io: SocketIOServer) {
  // è®¤è¯ä¸­é—´ä»¶
  io.use(async (socket: AuthenticatedSocket, next) => {
    try {
      const token = socket.handshake.auth.token
      if (!token) {
        return next(new Error('Authentication error'))
      }

      const payload = verifyJWT(token)
      socket.userId = payload.userId
      next()
    } catch (error) {
      next(new Error('Authentication error'))
    }
  })

  io.on('connection', (socket: AuthenticatedSocket) => {
    logger.info(`User ${socket.userId} connected`)

    // åŠ å…¥ç”¨æˆ·ä¸“å±æˆ¿é—´
    socket.join(`user:${socket.userId}`)

    // è®¢é˜…çº¢åŒ…æˆ¿é—´
    socket.on('subscribe:packet', (packetId: string) => {
      socket.join(`packet:${packetId}`)
      logger.info(`User ${socket.userId} subscribed to packet ${packetId}`)
    })

    // å–æ¶ˆè®¢é˜…
    socket.on('unsubscribe:packet', (packetId: string) => {
      socket.leave(`packet:${packetId}`)
    })

    // æ–­å¼€è¿æ¥
    socket.on('disconnect', () => {
      logger.info(`User ${socket.userId} disconnected`)
    })
  })

  return io
}

// å…¨å±€ IO å®ä¾‹
export let io: SocketIOServer

export function setIO(ioInstance: SocketIOServer) {
  io = ioInstance
}

// è¾…åŠ©å‡½æ•°:å‘ç”¨æˆ·å‘é€æ¶ˆæ¯
export function emitToUser(userId: string, event: string, data: any) {
  io.to(`user:${userId}`).emit(event, data)
}

// è¾…åŠ©å‡½æ•°:å‘çº¢åŒ…æˆ¿é—´å¹¿æ’­
export function emitToPacket(packetId: string, event: string, data: any) {
  io.to(`packet:${packetId}`).emit(event, data)
}
```

### åŒºå—é“¾ç›‘å¬ä»»åŠ¡

**src/jobs/syncPackets.job.ts**:
```typescript
import Queue from 'bull'
import { createPublicClient, http, parseAbiItem } from 'viem'
import { base } from 'viem/chains'
import { prisma } from '../index'
import { emitToPacket } from '../websocket'
import logger from '../utils/logger'
import { RED_PACKET_ADDRESS, RedPacketABI } from '../config/blockchain'

export const packetSyncQueue = new Queue('packet-sync', process.env.REDIS_URL!)

const client = createPublicClient({
  chain: base,
  transport: http(process.env.RPC_URL),
})

// ç›‘å¬ PacketClaimed äº‹ä»¶
packetSyncQueue.process('listen-claims', async (job) => {
  const fromBlock = BigInt(job.data.fromBlock || 0)
  
  try {
    const logs = await client.getLogs({
      address: RED_PACKET_ADDRESS,
      event: parseAbiItem('event PacketClaimed(bytes32 indexed packetId, address indexed claimer, uint256 amount, uint32 remainingCount)'),
      fromBlock,
      toBlock: 'latest',
    })

    for (const log of logs) {
      const { packetId, claimer, amount, remainingCount } = log.args

      // æ›´æ–°æ•°æ®åº“
      await prisma.claim.create({
        data: {
          packetId: packetId as string,
          userId: claimer as string, // éœ€è¦ä» address æ‰¾åˆ° userId
          amount: amount.toString(),
          txHash: log.transactionHash,
        },
      })

      await prisma.packet.update({
        where: { packetId: packetId as string },
        data: {
          remainingCount: Number(remainingCount),
        },
      })

      // WebSocket å®æ—¶æ¨é€
      emitToPacket(packetId as string, 'packet:claimed', {
        claimer,
        amount: amount.toString(),
        remainingCount: Number(remainingCount),
      })

      logger.info(`Packet ${packetId} claimed by ${claimer}`)
    }

    // è®°å½•æœ€æ–°åŒºå—
    const latestBlock = await client.getBlockNumber()
    return { processedBlocks: logs.length, latestBlock }
    
  } catch (error) {
    logger.error('Sync claims error:', error)
    throw error
  }
})

// æ¯ 30 ç§’è¿è¡Œä¸€æ¬¡
packetSyncQueue.add(
  'listen-claims',
  { fromBlock: null }, // null = ä»ä¸Šæ¬¡è®°å½•çš„åŒºå—å¼€å§‹
  { repeat: { every: 30000 } }
)

export function initJobs() {
  logger.info('Jobs initialized')
}
```

---

## æµ‹è¯•ç­–ç•¥

### æ™ºèƒ½åˆçº¦æµ‹è¯•

```bash
cd contracts

# å•å…ƒæµ‹è¯•
forge test

# æµ‹è¯•ç‰¹å®šå‡½æ•°
forge test --match-test testClaimFixedPacket -vvv

# Gas ä¼˜åŒ–æµ‹è¯•
forge test --gas-report

# Fork æµ‹è¯•(çœŸå®ç½‘ç»œçŠ¶æ€)
forge test --fork-url https://base-mainnet.g.alchemy.com/v2/YOUR_KEY

# è¦†ç›–ç‡
forge coverage

# Fuzz æµ‹è¯•
forge test --fuzz-runs 10000
```

### å‰ç«¯æµ‹è¯•

**å®‰è£…æµ‹è¯•ä¾èµ–**:
```bash
cd frontend
pnpm add -D @testing-library/react @testing-library/jest-dom vitest
```

**components/__tests__/CreateForm.test.tsx**:
```typescript
import { render, screen, fireEvent } from '@testing-library/react'
import { describe, it, expect, vi } from 'vitest'
import CreateRedPacketForm from '../RedPacket/CreateForm'

describe('CreateRedPacketForm', () => {
  it('renders form fields', () => {
    render(<CreateRedPacketForm />)
    
    expect(screen.getByText('æ€»é‡‘é¢')).toBeInTheDocument()
    expect(screen.getByText('çº¢åŒ…ä¸ªæ•°')).toBeInTheDocument()
    expect(screen.getByText('çº¢åŒ…ç±»å‹')).toBeInTheDocument()
  })

  it('validates amount input', async () => {
    render(<CreateRedPacketForm />)
    
    const input = screen.getByPlaceholderText('è¾“å…¥é‡‘é¢')
    fireEvent.change(input, { target: { value: '-10' } })
    
    // åº”è¯¥æ˜¾ç¤ºé”™è¯¯
    expect(input).toBeInvalid()
  })

  it('calculates fee correctly', () => {
    render(<CreateRedPacketForm />)
    
    const input = screen.getByPlaceholderText('è¾“å…¥é‡‘é¢')
    fireEvent.change(input, { target: { value: '100' } })
    
    expect(screen.getByText('$1.00')).toBeInTheDocument() // 1% fee
    expect(screen.getByText('$99.00')).toBeInTheDocument() // net amount
  })
})
```

### åç«¯æµ‹è¯•

**å®‰è£…æµ‹è¯•ä¾èµ–**:
```bash
cd backend
pnpm add -D jest @types/jest supertest @types/supertest
```

**src/__tests__/packet.test.ts**:
```typescript
import request from 'supertest'
import { app } from '../index'
import { prisma } from '../index'

describe('Packet API', () => {
  let authToken: string

  beforeAll(async () => {
    // ç™»å½•è·å– token
    const res = await request(app)
      .post('/api/auth/login')
      .send({ address: '0x123...' })
    authToken = res.body.token
  })

  afterAll(async () => {
    await prisma.$disconnect()
  })

  describe('POST /api/packets/create', () => {
    it('creates a packet successfully', async () => {
      const res = await request(app)
        .post('/api/packets/create')
        .set('Authorization', `Bearer ${authToken}`)
        .send({
          txHash: '0xabc...',
          packetId: '0xdef...',
          message: 'Test packet',
          amount: '100',
          count: 10,
          isRandom: true,
        })

      expect(res.status).toBe(201)
      expect(res.body.success).toBe(true)
      expect(res.body.data).toHaveProperty('id')
    })

    it('returns 400 for invalid data', async () => {
      const res = await request(app)
        .post('/api/packets/create')
        .set('Authorization', `Bearer ${authToken}`)
        .send({
          txHash: '0xabc...',
          // missing required fields
        })

      expect(res.status).toBe(400)
    })
  })

  describe('GET /api/packets/:packetId', () => {
    it('returns packet details', async () => {
      const res = await request(app)
        .get('/api/packets/test-packet-id')
        .set('Authorization', `Bearer ${authToken}`)

      expect(res.status).toBe(200)
      expect(res.body.data).toHaveProperty('packetId')
    })
  })
})
```

### é›†æˆæµ‹è¯•

**tests/e2e/redpacket.spec.ts** (ä½¿ç”¨ Playwright):
```typescript
import { test, expect } from '@playwright/test'

test.describe('Red Packet E2E', () => {
  test('complete flow: create and claim', async ({ page, context }) => {
    // ç¬¬ä¸€ä¸ªç”¨æˆ·:åˆ›å»ºçº¢åŒ…
    await page.goto('http://localhost:3000')
    
    await page.click('text=è¿æ¥é’±åŒ…')
    // ... è¿æ¥é’±åŒ…æµç¨‹
    
    await page.click('text=å‘çº¢åŒ…')
    await page.fill('[placeholder="è¾“å…¥é‡‘é¢"]', '10')
    await page.click('text=æ‹¼æ‰‹æ°”')
    await page.click('text=å¡é’±è¿›çº¢åŒ…')
    
    await page.waitForSelector('text=çº¢åŒ…åˆ›å»ºæˆåŠŸ')
    const packetUrl = await page.locator('[href^="/packet/"]').getAttribute('href')
    
    // ç¬¬äºŒä¸ªç”¨æˆ·:é¢†å–çº¢åŒ…
    const page2 = await context.newPage()
    await page2.goto(`http://localhost:3000${packetUrl}`)
    
    await page2.click('text=æŠ¢çº¢åŒ…')
    await page2.waitForSelector('text=æ­å–œ!')
    
    const amount = await page2.locator('text=/\\$[0-9.]+/').textContent()
    expect(amount).toBeTruthy()
  })
})
```

---

## éƒ¨ç½²æµç¨‹

### æ™ºèƒ½åˆçº¦éƒ¨ç½²

#### 1. æµ‹è¯•ç½‘éƒ¨ç½²(Base Sepolia)

```bash
cd contracts

# é…ç½®ç¯å¢ƒå˜é‡
export PRIVATE_KEY="your_private_key"
export ALCHEMY_API_KEY="your_alchemy_key"
export BASESCAN_API_KEY="your_basescan_key"

# éƒ¨ç½²
forge script script/Deploy.s.sol \
  --rpc-url base_sepolia \
  --broadcast \
  --verify \
  -vvvv

# è®°å½•åˆçº¦åœ°å€
echo "RED_PACKET_CONTRACT=0x..." >> ../.env
```

#### 2. ä¸»ç½‘éƒ¨ç½²(Base Mainnet)

```bash
# âš ï¸ ä¸»ç½‘éƒ¨ç½²è¯·ä½¿ç”¨ç¡¬ä»¶é’±åŒ…!

forge script script/Deploy.s.sol \
  --rpc-url base \
  --ledger \
  --sender 0xYourLedgerAddress \
  --broadcast \
  --verify \
  -vvvv
```

#### 3. åˆçº¦éªŒè¯

```bash
forge verify-contract \
  --chain-id 8453 \
  --num-of-optimizations 200 \
  --watch \
  --constructor-args $(cast abi-encode "constructor(address,uint64,bytes32,address)" 0xVRF... 123 0xKey... 0xFee...) \
  --compiler-version v0.8.24 \
  0xYourContractAddress \
  src/RedPacket.sol:RedPacket \
  --etherscan-api-key $BASESCAN_API_KEY
```

### å‰ç«¯éƒ¨ç½²(Vercel)

#### 1. è¿æ¥ GitHub

```bash
cd frontend

# åˆå§‹åŒ– Git(å¦‚æœè¿˜æ²¡æœ‰)
git init
git add .
git commit -m "Initial commit"

# æ¨é€åˆ° GitHub
git remote add origin https://github.com/yourusername/redpacket-frontend
git push -u origin main
```

#### 2. Vercel é…ç½®

ç™»å½• [vercel.com](https://vercel.com) â†’ Import Project â†’ é€‰æ‹©ä»“åº“

**vercel.json**:
```json
{
  "buildCommand": "pnpm build",
  "outputDirectory": ".next",
  "framework": "nextjs",
  "env": {
    "NEXT_PUBLIC_API_URL": "@api_url",
    "NEXT_PUBLIC_WS_URL": "@ws_url",
    "NEXT_PUBLIC_CHAIN_ID": "@chain_id",
    "NEXT_PUBLIC_ALCHEMY_API_KEY": "@alchemy_key",
    "NEXT_PUBLIC_PRIVY_APP_ID": "@privy_app_id",
    "NEXT_PUBLIC_RED_PACKET_CONTRACT": "@contract_address",
    "NEXT_PUBLIC_USDC_CONTRACT": "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"
  }
}
```

#### 3. éƒ¨ç½²

```bash
# å®‰è£… Vercel CLI
pnpm add -g vercel

# ç™»å½•
vercel login

# éƒ¨ç½²åˆ°é¢„è§ˆç¯å¢ƒ
vercel

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
vercel --prod
```

### åç«¯éƒ¨ç½²(Railway/Render)

#### ä½¿ç”¨ Railway

**railway.json**:
```json
{
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "pnpm install && pnpm prisma generate && pnpm build"
  },
  "deploy": {
    "startCommand": "pnpm prisma migrate deploy && pnpm start",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

**éƒ¨ç½²æ­¥éª¤**:
```bash
# å®‰è£… Railway CLI
npm i -g @railway/cli

# ç™»å½•
railway login

# åˆå§‹åŒ–é¡¹ç›®
railway init

# æ·»åŠ  PostgreSQL æœåŠ¡
railway add -d postgres

# æ·»åŠ  Redis æœåŠ¡
railway add -d redis

# è®¾ç½®ç¯å¢ƒå˜é‡
railway variables set NODE_ENV=production
railway variables set DATABASE_URL=${{Postgres.DATABASE_URL}}
railway variables set REDIS_URL=${{Redis.REDIS_URL}}

# éƒ¨ç½²
railway up
```

#### ä½¿ç”¨ Docker

**Dockerfile**:
```dockerfile
FROM node:20-alpine AS base

# Dependencies
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app

COPY package.json pnpm-lock.yaml* ./
RUN corepack enable pnpm && pnpm install --frozen-lockfile

# Builder
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

RUN corepack enable pnpm && \
    pnpm prisma generate && \
    pnpm build

# Runner
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nodejs

COPY --from=builder --chown=nodejs:nodejs /app/dist ./dist
COPY --from=builder --chown=nodejs:nodejs /app/node_modules ./node_modules
COPY --from=builder --chown=nodejs:nodejs /app/package.json ./package.json
COPY --from=builder --chown=nodejs:nodejs /app/prisma ./prisma

USER nodejs

EXPOSE 3001

CMD ["node", "dist/index.js"]
```

**docker-compose.yml**:
```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://postgres:password@postgres:5432/redpacket
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis

  postgres:
    image: postgres:16-alpine
    environment:
      - POSTGRES_DB=redpacket
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

---

## äº§å“åŠŸèƒ½è§„æ ¼

### MVP åŠŸèƒ½æ¸…å•

âœ… **å¿…é¡»æœ‰(P0)**
- ç”¨æˆ·ç™»å½•(Privy)
- åˆ›å»ºçº¢åŒ…(å›ºå®š/éšæœº)
- æŠ¢çº¢åŒ…(Frame + Web)
- çº¢åŒ…è¯¦æƒ…é¡µ
- é¢†å–è®°å½•
- ä½™é¢æŸ¥çœ‹

âš ï¸ **åº”è¯¥æœ‰(P1)**
- é‚€è¯·å¥–åŠ±
- æ’è¡Œæ¦œ(å‘¨æ¦œ)
- æˆå°±ç³»ç»Ÿ(åŸºç¡€3ä¸ª)
- æ¨é€é€šçŸ¥
- çº¢åŒ…é›¨(å®šæ—¶)

ğŸ’¡ **å¯ä»¥æœ‰(P2)**
- NFT çº¢åŒ…
- ç¾¤çº¢åŒ…
- å®šæ—¶çº¢åŒ…
- å¤šå¸ç§æ”¯æŒ

### ç”¨æˆ·æµç¨‹å›¾

```
[æ–°ç”¨æˆ·]
    â†“
  ç™»å½•(é‚®ç®±/Farcaster)
    â†“
  åˆ›å»º AA é’±åŒ…(è‡ªåŠ¨)
    â†“
  â”Œâ”€å……å€¼ USDC (é€‰é¡¹1)
  â””â”€é¢†å–æ–°äººçº¢åŒ… (é€‰é¡¹2)
    â†“
  [é€‰æ‹©è¡ŒåŠ¨]
    â”œâ”€ å‘çº¢åŒ… â†’ åˆ†äº«åˆ° Warpcast â†’ ç­‰å¾…é¢†å–
    â””â”€ æŠ¢çº¢åŒ… â†’ æŸ¥çœ‹ Feed â†’ ç‚¹å‡»æŠ¢ â†’ æˆåŠŸ!
```

### æ•°æ®æŒ‡æ ‡

**æ ¸å¿ƒæŒ‡æ ‡(North Star Metric)**:
- æ—¥å‡å‘çº¢åŒ…æ•°(DSR - Daily Sent RedPackets)

**å¢é•¿æŒ‡æ ‡**:
- DAU(æ—¥æ´»ç”¨æˆ·)
- æ³¨å†Œç”¨æˆ·æ•°
- K-Factor(ç—…æ¯’ç³»æ•°)
- é‚€è¯·è½¬åŒ–ç‡

**å‚ä¸åº¦æŒ‡æ ‡**:
- å¹³å‡æ¯ç”¨æˆ·å‘çº¢åŒ…æ•°
- å¹³å‡æ¯ç”¨æˆ·æŠ¢çº¢åŒ…æ•°
- çº¢åŒ…é¢†å–ç‡(è¢«æŠ¢å®Œçš„æ¯”ä¾‹)
- å¹³å‡çº¢åŒ…é‡‘é¢

**ç•™å­˜æŒ‡æ ‡**:
- D1/D7/D30 ç•™å­˜ç‡
- å‘¨æ´»/æœˆæ´»æ¯”(WAU/MAU)
- æµå¤±ç‡

**å•†ä¸šåŒ–æŒ‡æ ‡**:
- å¹³å°æ‰‹ç»­è´¹æ”¶å…¥
- ä»˜è´¹ç”¨æˆ·æ•°
- ARPU(å¹³å‡æ¯ç”¨æˆ·æ”¶å…¥)
- LTV(ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼)

---

## ç—…æ¯’å¢é•¿æœºåˆ¶

### å®ç°æ¸…å•

âœ… **é‚€è¯·å¥–åŠ±ç³»ç»Ÿ**
- [ ] æ™ºèƒ½åˆçº¦è®°å½•é‚€è¯·å…³ç³»
- [ ] åç«¯è‡ªåŠ¨å‘æ”¾å¥–åŠ±
- [ ] å‰ç«¯é‚€è¯·é“¾æ¥ç”Ÿæˆ
- [ ] é‚€è¯·æ’è¡Œæ¦œ

âœ… **åŠ©åŠ›æŠ¢çº¢åŒ…**
- [ ] Frame æŒ‰é’®:é‚€è¯·åŠ©åŠ›
- [ ] è®°å½•åŠ©åŠ›å…³ç³»
- [ ] è§£é”å®Œæ•´é‡‘é¢

âœ… **æ’è¡Œæ¦œç³»ç»Ÿ**
- [ ] æ‰‹æ°”æ¦œ(å‘¨æ¦œ)
- [ ] æ…·æ…¨æ¦œ(æœˆæ¦œ)
- [ ] æ´»è·ƒæ¦œ(å®æ—¶)
- [ ] æ’åæ¨é€é€šçŸ¥

âœ… **æˆå°±ç³»ç»Ÿ**
- [ ] æ•°æ®åº“ Schema
- [ ] æˆå°±è§£é”é€»è¾‘
- [ ] å¾½ç«  NFT é“¸é€ 
- [ ] åˆ†äº«å¡ç‰‡ç”Ÿæˆ

âœ… **å®šæ—¶çº¢åŒ…é›¨**
- [ ] Cron Job å®šæ—¶å‘æ”¾
- [ ] å€’è®¡æ—¶æé†’
- [ ] Frame å¿«é€Ÿé¢†å–

âœ… **æ¨é€é€šçŸ¥**
- [ ] WebSocket å®æ—¶æ¨é€
- [ ] é‚®ä»¶é€šçŸ¥(å¯é€‰)
- [ ] Telegram Bot(å¯é€‰)

---

## å®‰å…¨å®¡è®¡æ¸…å•

### æ™ºèƒ½åˆçº¦å®‰å…¨

- [ ] Reentrancy Guard(å·²å®ç°)
- [ ] Access Control(Owner only)
- [ ] Integer Overflow(Solidity 0.8+)
- [ ] Front-running é˜²æŠ¤
- [ ] Gas Limit æ”»å‡»é˜²æŠ¤
- [ ] éšæœºæ•°å®‰å…¨(Chainlink VRF)
- [ ] å‡çº§æœºåˆ¶(å¦‚éœ€è¦)

### å¤–éƒ¨å®¡è®¡

- [ ] CertiK å®¡è®¡
- [ ] SlowMist å®¡è®¡
- [ ] OpenZeppelin Defender ç›‘æ§
- [ ] Bug Bounty è®¡åˆ’

### å‰ç«¯å®‰å…¨

- [ ] XSS é˜²æŠ¤
- [ ] CSRF Token
- [ ] Content Security Policy
- [ ] ç§é’¥æœ¬åœ°å­˜å‚¨åŠ å¯†

### åç«¯å®‰å…¨

- [ ] SQL æ³¨å…¥é˜²æŠ¤(Prisma ORM)
- [ ] Rate Limiting
- [ ] JWT Token è¿‡æœŸ
- [ ] CORS ç™½åå•
- [ ] Helmet.js å®‰å…¨å¤´
- [ ] Input Validation

### è¿ç»´å®‰å…¨

- [ ] ç¯å¢ƒå˜é‡åŠ å¯†
- [ ] æ•°æ®åº“å¤‡ä»½
- [ ] æ—¥å¿—ç›‘æ§(Sentry)
- [ ] DDoS é˜²æŠ¤(Cloudflare)
- [ ] å®šæœŸå®‰å…¨æ‰«æ

---

## å¼€å‘è·¯çº¿å›¾

### Phase 1: MVP (Week 1-8)

**Week 1-2: åŸºç¡€è®¾æ–½**
- [x] é¡¹ç›®ç»“æ„æ­å»º
- [ ] æ™ºèƒ½åˆçº¦å¼€å‘
- [ ] æ•°æ®åº“è®¾è®¡
- [ ] API æ¡†æ¶æ­å»º

**Week 3-4: æ ¸å¿ƒåŠŸèƒ½**
- [ ] åˆ›å»ºçº¢åŒ…(å›ºå®š+éšæœº)
- [ ] æŠ¢çº¢åŒ…é€»è¾‘
- [ ] Frame é›†æˆ
- [ ] AA é’±åŒ…é›†æˆ

**Week 5-6: å‰ç«¯ UI**
- [ ] å‘çº¢åŒ…é¡µé¢
- [ ] æŠ¢çº¢åŒ…åŠ¨ç”»
- [ ] çº¢åŒ…è¯¦æƒ…é¡µ
- [ ] ä¸ªäººä¸­å¿ƒ

**Week 7: æµ‹è¯• & ä¼˜åŒ–**
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å®‰å…¨å®¡è®¡

**Week 8: å‘å¸ƒ**
- [ ] éƒ¨ç½²æµ‹è¯•ç½‘
- [ ] Beta æµ‹è¯•(100 ç”¨æˆ·)
- [ ] æ”¶é›†åé¦ˆ
- [ ] ä¸»ç½‘éƒ¨ç½²

### Phase 2: å¢é•¿åŠŸèƒ½ (Week 9-16)

**Week 9-10: ç—…æ¯’æœºåˆ¶**
- [ ] é‚€è¯·å¥–åŠ±ç³»ç»Ÿ
- [ ] åŠ©åŠ›æŠ¢çº¢åŒ…
- [ ] åˆ†äº«å¡ç‰‡ç”Ÿæˆ

**Week 11-12: ç¤¾äº¤åŠŸèƒ½**
- [ ] æ’è¡Œæ¦œç³»ç»Ÿ
- [ ] æˆå°±ç³»ç»Ÿ
- [ ] å¥½å‹å…³ç³»é“¾

**Week 13-14: è¿è¥å·¥å…·**
- [ ] å®šæ—¶çº¢åŒ…é›¨
- [ ] æ¨é€é€šçŸ¥
- [ ] ç®¡ç†åå°

**Week 15-16: ä¼˜åŒ–è¿­ä»£**
- [ ] æ•°æ®åˆ†æçœ‹æ¿
- [ ] A/B æµ‹è¯•å¹³å°
- [ ] ç”¨æˆ·åé¦ˆç³»ç»Ÿ

### Phase 3: é«˜çº§åŠŸèƒ½ (Week 17-24)

- [ ] NFT çº¢åŒ…
- [ ] ç¾¤çº¢åŒ…(Farcaster Channel)
- [ ] å®šæ—¶çº¢åŒ…
- [ ] è·¨é“¾æ”¯æŒ(Arbitrum, Optimism)
- [ ] ç§»åŠ¨ç«¯ App
- [ ] ä»£å¸ç»æµæ¨¡å‹($PACKET)

---

## é™„å½•

### æœ‰ç”¨çš„èµ„æº

**åŒºå—é“¾**
- [Base æ–‡æ¡£](https://docs.base.org/)
- [Foundry Book](https://book.getfoundry.sh/)
- [Viem æ–‡æ¡£](https://viem.sh/)
- [OpenZeppelin åˆçº¦](https://docs.openzeppelin.com/contracts/)

**Farcaster**
- [Farcaster æ–‡æ¡£](https://docs.farcaster.xyz/)
- [Frames å¼€å‘æŒ‡å—](https://docs.farcaster.xyz/developers/frames)
- [Frog Framework](https://frog.fm/)

**å‰ç«¯**
- [Next.js æ–‡æ¡£](https://nextjs.org/docs)
- [Privy æ–‡æ¡£](https://docs.privy.io/)
- [Wagmi æ–‡æ¡£](https://wagmi.sh/)

**åç«¯**
- [Prisma æ–‡æ¡£](https://www.prisma.io/docs)
- [Bull æ–‡æ¡£](https://github.com/OptimalBits/bull)
- [Socket.IO æ–‡æ¡£](https://socket.io/docs/)

### ç¤¾åŒºæ”¯æŒ

- [Base Discord](https://base.org/discord)
- [Farcaster Developers](https://warpcast.com/~/channel/fc-devs)
- [Privy Discord](https://privy.io/discord)

### å¼€å‘å·¥å…·

- [Remix IDE](https://remix.ethereum.org/) - åœ¨çº¿ Solidity IDE
- [Tenderly](https://tenderly.co/) - åˆçº¦è°ƒè¯•
- [Alchemy Dashboard](https://dashboard.alchemy.com/) - RPC ç›‘æ§
- [Vercel Analytics](https://vercel.com/analytics) - å‰ç«¯æ€§èƒ½
- [Sentry](https://sentry.io/) - é”™è¯¯è¿½è¸ª

---

## æ€»ç»“

è¿™ä»½æ–‡æ¡£æ¶µç›–äº†ä»é›¶å¼€å§‹æ„å»º Base çº¢åŒ… dApp çš„å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ:

âœ… **æŠ€æœ¯æ¶æ„**: å‰åç«¯åˆ†ç¦» + åŒºå—é“¾
âœ… **æ™ºèƒ½åˆçº¦**: Solidity + Foundry + å®‰å…¨å®¡è®¡
âœ… **å‰ç«¯**: Next.js + Privy AA + Farcaster Frames
âœ… **åç«¯**: Node.js + Prisma + WebSocket
âœ… **æµ‹è¯•**: å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + E2E
âœ… **éƒ¨ç½²**: Vercel + Railway + Docker
âœ… **äº§å“**: MVP åŠŸèƒ½ + ç—…æ¯’å¢é•¿æœºåˆ¶
âœ… **å®‰å…¨**: å¤šå±‚é˜²æŠ¤ + å®¡è®¡æ¸…å•

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
1. Fork è¿™ä¸ªæ–‡æ¡£,å¼€å§‹æ­å»ºç¯å¢ƒ
2. å…ˆå®Œæˆæ™ºèƒ½åˆçº¦ + æµ‹è¯•
3. å¹¶è¡Œå¼€å‘å‰åç«¯
4. æŒç»­è¿­ä»£,å¿«é€Ÿå‘å¸ƒ

**è®°ä½**: å®Œæˆæ¯”å®Œç¾æ›´é‡è¦ã€‚å…ˆåšå‡º MVP,å¿«é€Ÿä¸Šçº¿,æ ¹æ®ç”¨æˆ·åé¦ˆè¿­ä»£!

ç¥ä½ å¼€å‘é¡ºåˆ©! ğŸš€ğŸ§§
