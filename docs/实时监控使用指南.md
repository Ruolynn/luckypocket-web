# 实时监控使用指南

## 🎯 功能说明

提供了两种终端监控方式：
1. **实时监控** - 持续刷新显示状态（推荐）
2. **快速检查** - 单次显示当前状态

## 🚀 使用方法

### 方式 1: 实时监控（推荐）

在终端持续显示服务状态，自动刷新：

```bash
./scripts/watch-status.sh
```

**特性**:
- ✅ 每 5 秒自动刷新（可自定义）
- ✅ 彩色状态显示
- ✅ 显示详细信息（容器状态、系统资源等）
- ✅ 按 `Ctrl+C` 停止

**自定义刷新间隔**:
```bash
# 每 3 秒刷新一次
REFRESH_INTERVAL=3 ./scripts/watch-status.sh

# 每 10 秒刷新一次
REFRESH_INTERVAL=10 ./scripts/watch-status.sh
```

### 方式 2: 快速检查

单次显示当前状态，不循环：

```bash
./scripts/quick-status.sh
```

**适用场景**:
- 快速查看当前状态
- 不需要持续监控
- 作为脚本的一部分使用

### 方式 3: 后台监控 + 实时查看

结合使用后台监控和实时查看：

```bash
# 终端 1: 启动后台监控（每5分钟检查一次，记录日志）
./scripts/monitor-status.sh > /dev/null 2>&1 &

# 终端 2: 实时查看状态（每5秒刷新）
./scripts/watch-status.sh
```

## 📊 显示内容

### 实时监控显示

```
═══════════════════════════════════════════════════════════
          🧧 HongBao 服务状态实时监控
═══════════════════════════════════════════════════════════

📊 检查时间: 2025-11-06 19:30:00
🔄 刷新间隔: 5 秒
⏹️  按 Ctrl+C 停止监控

✅ API 服务 运行中
   📍 http://localhost:3001
   💚 healthy

⚠️  Web 服务 未运行 (可选)
   📍 http://localhost:9000

✅ PostgreSQL 运行中
   🐳 容器: hongbao-postgres-1
   📊 状态: Up 6 days (healthy)

✅ Redis 运行中
   🐳 容器: hongbao-redis-1
   📊 状态: Up 6 days (healthy)

🐳 Docker 容器状态:
   • hongbao-postgres-1: Up 6 days (healthy)
   • hongbao-redis-1: Up 6 days (healthy)

💻 系统资源:
   ⚡ CPU: 15.2%
   💾 内存: 8192MB

📈 服务统计:
   ✅ 运行中: 3/4
   ⏱️ 下次刷新: 19:30:05

═══════════════════════════════════════════════════════════
```

### 快速检查显示

```
═══════════════════════════════════════════════════════════
          🧧 HongBao 服务状态
═══════════════════════════════════════════════════════════

✅ API 服务 运行中 (http://localhost:3001)
⚠️  Web 服务 未运行 (http://localhost:9000)
✅ PostgreSQL 运行中
✅ Redis 运行中

═══════════════════════════════════════════════════════════
```

## 🎨 状态颜色说明

- 🟢 **绿色 (✅)**: 服务正常运行
- 🟡 **黄色 (⚠️)**: 服务未运行（非关键服务，如 Web）
- 🔴 **红色 (❌)**: 服务未运行（关键服务，如 API、数据库）

## ⚙️ 配置选项

### 环境变量

```bash
# 自定义 API URL
API_URL=http://localhost:3001 ./scripts/watch-status.sh

# 自定义 Web URL
WEB_URL=http://localhost:9000 ./scripts/watch-status.sh

# 自定义刷新间隔（秒）
REFRESH_INTERVAL=10 ./scripts/watch-status.sh
```

## 💡 使用建议

### 开发时

```bash
# 在一个终端运行实时监控
./scripts/watch-status.sh
```

### 调试时

```bash
# 快速检查一次状态
./scripts/quick-status.sh
```

### 长时间监控

```bash
# 使用后台监控记录日志
./scripts/monitor-status.sh > /dev/null 2>&1 &

# 需要时查看日志
tail -f logs/monitor-$(date +%Y%m%d).log
```

## 🔧 故障排查

### 如果实时监控不显示

1. 检查脚本权限：
```bash
chmod +x scripts/watch-status.sh
```

2. 检查依赖：
```bash
# 需要 curl 和 docker
which curl docker
```

3. 检查终端支持：
```bash
# 测试颜色支持
echo -e "\033[0;32m绿色\033[0m"
```

### 如果刷新太快/太慢

调整 `REFRESH_INTERVAL` 环境变量：
```bash
# 更快的刷新（2秒）
REFRESH_INTERVAL=2 ./scripts/watch-status.sh

# 更慢的刷新（30秒）
REFRESH_INTERVAL=30 ./scripts/watch-status.sh
```

## 📝 与其他工具结合

### 与压力测试结合

```bash
# 终端 1: 运行压力测试
./scripts/load-test/load-test.sh

# 终端 2: 实时监控服务状态
./scripts/watch-status.sh
```

### 与开发环境结合

```bash
# 终端 1: 启动 API
cd apps/api && pnpm dev

# 终端 2: 启动 Web
cd apps/web && pnpm dev

# 终端 3: 实时监控
./scripts/watch-status.sh
```

## 🎯 最佳实践

1. **开发时**: 使用实时监控 (`watch-status.sh`)
2. **快速检查**: 使用快速检查 (`quick-status.sh`)
3. **长时间监控**: 使用后台监控 (`monitor-status.sh`)
4. **压力测试时**: 同时运行实时监控观察服务状态

## 📞 提示

- 实时监控会占用一个终端窗口
- 可以使用 `tmux` 或 `screen` 在后台运行
- 按 `Ctrl+C` 随时停止监控
- 所有状态检查都是非阻塞的，不会影响服务运行

